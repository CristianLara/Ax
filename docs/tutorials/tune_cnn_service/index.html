<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-0.9.3 docs-doc-page docs-doc-id-tutorials/tune_cnn_service/index" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.5.2">
<title data-rh="true">Hyperparameter Optimization for PyTorch | Ax</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="http://cristianlara.me/Ax/img/ax.svg"><meta data-rh="true" name="twitter:image" content="http://cristianlara.me/Ax/img/ax.svg"><meta data-rh="true" property="og:url" content="http://cristianlara.me/Ax/docs/tutorials/tune_cnn_service/"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="0.9.3"><meta data-rh="true" name="docusaurus_tag" content="docs-default-0.9.3"><meta data-rh="true" name="docsearch:version" content="0.9.3"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-0.9.3"><meta data-rh="true" property="og:title" content="Hyperparameter Optimization for PyTorch | Ax"><meta data-rh="true" name="description" content="&lt;LinkButtons"><meta data-rh="true" property="og:description" content="&lt;LinkButtons"><link data-rh="true" rel="icon" href="/Ax/img/favicon.png"><link data-rh="true" rel="canonical" href="http://cristianlara.me/Ax/docs/tutorials/tune_cnn_service/"><link data-rh="true" rel="alternate" href="http://cristianlara.me/Ax/docs/tutorials/tune_cnn_service/" hreflang="en"><link data-rh="true" rel="alternate" href="http://cristianlara.me/Ax/docs/tutorials/tune_cnn_service/" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://8X3RTPIIL1-dsn.algolia.net" crossorigin="anonymous"><link rel="alternate" type="application/rss+xml" href="/Ax/blog/rss.xml" title="Ax RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/Ax/blog/atom.xml" title="Ax Atom Feed">



<link rel="search" type="application/opensearchdescription+xml" title="Ax" href="/Ax/opensearch.xml">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.24/dist/katex.min.css" integrity="sha384-odtC+0UGzzFL/6PNoE8rX/SPcQDXBJ+uRepguP4QkPCm2LBxH3FA3y+fKSiJ+AmM" crossorigin="anonymous">
<script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
<script src="/Ax/js/plotUtils.js"></script>
<script src="https://buttons.github.io/buttons.js"></script>
<script src="https://cdn.bokeh.org/bokeh/release/bokeh-2.4.2.min.js"></script>
<script src="https://cdn.bokeh.org/bokeh/release/bokeh-widgets-2.4.2.min.js"></script><link rel="stylesheet" href="/Ax/assets/css/styles.ea52e071.css">
<script src="/Ax/assets/js/runtime~main.b3021ee5.js" defer="defer"></script>
<script src="/Ax/assets/js/main.9d0bf699.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top navbarHideable_m1mJ"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/Ax/"><div class="navbar__logo"><img src="/Ax/img/ax.svg" alt="" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/Ax/img/ax.svg" alt="" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Ax</b></a><a class="navbar__item navbar__link" href="/Ax/docs/why-ax">Docs</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/Ax/docs/tutorials/">Tutorials</a><a href="https://ax.readthedocs.io/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">API<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><a class="navbar__item navbar__link" href="/Ax/blog">Blog</a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a aria-current="page" class="navbar__link active" aria-haspopup="true" aria-expanded="false" role="button" href="/Ax/docs/tutorials/tune_cnn_service/">0.9.3</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/Ax/docs/next/tutorials/tune_cnn_service/">Next</a></li><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/Ax/docs/tutorials/tune_cnn_service/">0.9.3</a></li><li><a class="dropdown__link" href="/Ax/docs/0.9.2/tutorials/tune_cnn_service/">0.9.2</a></li><li><a class="dropdown__link" href="/Ax/docs/0.9.1/tutorials/tune_cnn_service/">0.9.1</a></li><li><a class="dropdown__link" href="/Ax/docs/0.1.1/tutorials/tune_cnn_service/">0.1.1</a></li><li><a class="dropdown__link" href="/Ax/docs/0.1.0/tutorials/tune_cnn_service/">0.1.0</a></li><li><hr class="margin-vert--sm"></li><li class="margin-horiz--sm text--bold"><small>Archived versions<small></small></small></li><li><a href="https://ax.dev" target="_blank" rel="noopener noreferrer" class="dropdown__link">0.x.x<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><a href="https://github.com/cristianlara/Ax" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" aria-label="GitHub"></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search (Command+K)"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20" aria-hidden="true"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd sidebarWithHideableNavbar_wUlq"><a tabindex="-1" class="sidebarLogo_isFc" href="/Ax/"><img src="/Ax/img/ax.svg" alt="" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/Ax/img/ax.svg" alt="" class="themedComponent_mlkZ themedComponent--dark_xIcU"><b>Ax</b></a><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="true" href="/Ax/docs/tutorials/">Tutorials</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/Ax/docs/tutorials/">Overview</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/Ax/docs/tutorials/gpei_hartmann_service/">API Comparison</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/Ax/docs/tutorials/visualizations/">Deep Dives</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/Ax/docs/tutorials/tune_cnn_service/">Bayesian Optimization</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/Ax/docs/tutorials/tune_cnn_service/">Hyperparameter Optimization for PyTorch</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/Ax/docs/tutorials/submitit/">Hyperparameter Optimization on SLURM via SubmitIt</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/Ax/docs/tutorials/multi_task/">Multi-Task Modeling</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/Ax/docs/tutorials/multiobjective_optimization/">Multi-Objective Optimization</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/Ax/docs/tutorials/saasbo/">High-Dimensional Bayesian Optimization with Sparse Axis-Aligned Subspaces (SAASBO)</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/Ax/docs/tutorials/saasbo_nehvi/">Fully Bayesian, High-Dimensional, Multi-Objective Optimization</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/Ax/docs/tutorials/sebo/">Sparsity Exploration Bayesian Optimization (SEBO)</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/Ax/docs/tutorials/early_stopping/">Trial-Level Early Stopping</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/Ax/docs/tutorials/gss/">Global Stopping (Experiment-Level Early Stopping)</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/Ax/docs/tutorials/factorial/">Field Experiments</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/Ax/docs/tutorials/external_generation_node/">Integrating External Strategies</a></div></li></ul></nav><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_kv0_"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/Ax/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Bayesian Optimization</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Hyperparameter Optimization for PyTorch</span><meta itemprop="position" content="2"></li></ul></nav><span class="theme-doc-version-badge badge badge--secondary">Version: 0.9.3</span><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><div class="margin-top--sm margin-bottom--lg"><a href="https://github.com/cristianlara/Ax/blob/main/tutorials/tune_cnn_service.ipynb" target="_blank" rel="noopener noreferrer" class="button button--outline button--primary margin-right--xs">Open in GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><a href="https://colab.research.google.com/github/cristianlara/Ax/blob/main/tutorials/tune_cnn_service.ipynb" target="_blank" rel="noopener noreferrer" class="button button--outline button--primary margin--xs">Run in Google Colab<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></div>
<header><h1>Tune a CNN on MNIST</h1></header>
<p>This tutorial walks through using Ax to tune two hyperparameters (learning rate and
momentum) for a PyTorch CNN on the MNIST dataset trained using SGD with momentum.</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">import</span><span class="token plain"> torch</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">import</span><span class="token plain"> torch</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">nn </span><span class="token keyword" style="font-style:italic">as</span><span class="token plain"> nn</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">import</span><span class="token plain"> torch</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">nn</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">functional </span><span class="token keyword" style="font-style:italic">as</span><span class="token plain"> F</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> ax</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">service</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">ax_client </span><span class="token keyword" style="font-style:italic">import</span><span class="token plain"> AxClient</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> ObjectiveProperties</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> ax</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">service</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">utils</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">report_utils </span><span class="token keyword" style="font-style:italic">import</span><span class="token plain"> exp_to_df</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> ax</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">utils</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">notebook</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">plotting </span><span class="token keyword" style="font-style:italic">import</span><span class="token plain"> init_notebook_plotting</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> render</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> ax</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">utils</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">tutorials</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">cnn_utils </span><span class="token keyword" style="font-style:italic">import</span><span class="token plain"> evaluate</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> load_mnist</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> train</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> torch</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">_tensor </span><span class="token keyword" style="font-style:italic">import</span><span class="token plain"> Tensor</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> torch</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">utils</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">data </span><span class="token keyword" style="font-style:italic">import</span><span class="token plain"> DataLoader</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">init_notebook_plotting</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div style="background-color:var(--ifm-pre-background);margin-bottom:10px;border-radius:var(--ifm-global-radius);overflow:hidden;padding:5px;font:var(--ifm-code-font-size) / var(--ifm-pre-line-height) var(--ifm-font-family-monospace)"><span style="color:red">Out: </span><pre style="margin:0px;background-color:inherit;padding:8px"><p style="margin-bottom:0px">[INFO 09-29 17:03:02] ax.utils.notebook.plotting: Injecting Plotly library into cell. Do not overwrite or delete cell.</p></pre></div>
<div style="background-color:var(--ifm-pre-background);margin-bottom:10px;border-radius:var(--ifm-global-radius);overflow:hidden;padding:5px;font:var(--ifm-code-font-size) / var(--ifm-pre-line-height) var(--ifm-font-family-monospace)"><span style="color:red">Out: </span><pre style="margin:0px;background-color:inherit;padding:8px"><p style="margin-bottom:0px">[INFO 09-29 17:03:02] ax.utils.notebook.plotting: Please see</p><p style="margin-bottom:0px">  (https://ax.dev/tutorials/visualizations.html#Fix-for-plots-that-are-not-rendering)</p><p style="margin-bottom:0px">  if visualizations are not rendering.</p></pre></div>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">torch</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">manual_seed</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">42</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">dtype </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> torch</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token builtin" style="color:rgb(130, 170, 255)">float</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">device </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> torch</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">device</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;cuda&quot;</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> torch</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">cuda</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">is_available</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">else</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;cpu&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="1-load-mnist-data">1. Load MNIST data<a href="#1-load-mnist-data" class="hash-link" aria-label="Direct link to 1. Load MNIST data" title="Direct link to 1. Load MNIST data">​</a></h2>
<p>First, we need to load the MNIST data and partition it into training, validation, and
test sets.</p>
<p>Note: this will download the dataset if necessary.</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">BATCH_SIZE </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">512</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">train_loader</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> valid_loader</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> test_loader </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> load_mnist</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">batch_size</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">BATCH_SIZE</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div style="background-color:var(--ifm-pre-background);margin-bottom:10px;border-radius:var(--ifm-global-radius);overflow:hidden;padding:5px;font:var(--ifm-code-font-size) / var(--ifm-pre-line-height) var(--ifm-font-family-monospace)"><span style="color:red">Out: </span><pre style="margin:0px;background-color:inherit;padding:8px"><p style="margin-bottom:0px">Downloading http://yann.lecun.com/exdb/mnist/train-images-idx3-ubyte.gz</p></pre></div>
<div style="background-color:var(--ifm-pre-background);margin-bottom:10px;border-radius:var(--ifm-global-radius);overflow:hidden;padding:5px;font:var(--ifm-code-font-size) / var(--ifm-pre-line-height) var(--ifm-font-family-monospace)"><span style="color:red">Out: </span><pre style="margin:0px;background-color:inherit;padding:8px"><p style="margin-bottom:0px">Failed to download (trying next):</p><p style="margin-bottom:0px">HTTP Error 403: Forbidden</p><p style="margin-bottom:0px">Downloading https://ossci-datasets.s3.amazonaws.com/mnist/train-images-idx3-ubyte.gz</p><p style="margin-bottom:0px">Downloading https://ossci-datasets.s3.amazonaws.com/mnist/train-images-idx3-ubyte.gz to ./data/MNIST/raw/train-images-idx3-ubyte.gz</p></pre></div>
<div style="background-color:var(--ifm-pre-background);margin-bottom:10px;border-radius:var(--ifm-global-radius);overflow:hidden;padding:5px;font:var(--ifm-code-font-size) / var(--ifm-pre-line-height) var(--ifm-font-family-monospace)"><span style="color:red">Out: </span><pre style="margin:0px;background-color:inherit;padding:8px"><p style="margin-bottom:0px">  0%|                                                    | 0/9912422 [00:00&lt;?, ?it/s]</p></pre></div>
<div style="background-color:var(--ifm-pre-background);margin-bottom:10px;border-radius:var(--ifm-global-radius);overflow:hidden;padding:5px;font:var(--ifm-code-font-size) / var(--ifm-pre-line-height) var(--ifm-font-family-monospace)"><span style="color:red">Out: </span><pre style="margin:0px;background-color:inherit;padding:8px"><p style="margin-bottom:0px"> 10%|███▎                              | 983040/9912422 [00:00&lt;00:00, 9815665.87it/s]</p></pre></div>
<div style="background-color:var(--ifm-pre-background);margin-bottom:10px;border-radius:var(--ifm-global-radius);overflow:hidden;padding:5px;font:var(--ifm-code-font-size) / var(--ifm-pre-line-height) var(--ifm-font-family-monospace)"><span style="color:red">Out: </span><pre style="margin:0px;background-color:inherit;padding:8px"><p style="margin-bottom:0px"> 23%|███████▍                        | 2293760/9912422 [00:00&lt;00:00, 11596202.59it/s]</p></pre></div>
<div style="background-color:var(--ifm-pre-background);margin-bottom:10px;border-radius:var(--ifm-global-radius);overflow:hidden;padding:5px;font:var(--ifm-code-font-size) / var(--ifm-pre-line-height) var(--ifm-font-family-monospace)"><span style="color:red">Out: </span><pre style="margin:0px;background-color:inherit;padding:8px"><p style="margin-bottom:0px"> 35%|███████████▏                    | 3473408/9912422 [00:00&lt;00:00, 11286185.72it/s]</p></pre></div>
<div style="background-color:var(--ifm-pre-background);margin-bottom:10px;border-radius:var(--ifm-global-radius);overflow:hidden;padding:5px;font:var(--ifm-code-font-size) / var(--ifm-pre-line-height) var(--ifm-font-family-monospace)"><span style="color:red">Out: </span><pre style="margin:0px;background-color:inherit;padding:8px"><p style="margin-bottom:0px"> 47%|██████████████▉                 | 4620288/9912422 [00:00&lt;00:00, 10497514.38it/s]</p></pre></div>
<div style="background-color:var(--ifm-pre-background);margin-bottom:10px;border-radius:var(--ifm-global-radius);overflow:hidden;padding:5px;font:var(--ifm-code-font-size) / var(--ifm-pre-line-height) var(--ifm-font-family-monospace)"><span style="color:red">Out: </span><pre style="margin:0px;background-color:inherit;padding:8px"><p style="margin-bottom:0px"> 58%|██████████████████▍             | 5701632/9912422 [00:00&lt;00:00, 10535690.23it/s]</p></pre></div>
<div style="background-color:var(--ifm-pre-background);margin-bottom:10px;border-radius:var(--ifm-global-radius);overflow:hidden;padding:5px;font:var(--ifm-code-font-size) / var(--ifm-pre-line-height) var(--ifm-font-family-monospace)"><span style="color:red">Out: </span><pre style="margin:0px;background-color:inherit;padding:8px"><p style="margin-bottom:0px"> 68%|██████████████████████▌          | 6782976/9912422 [00:00&lt;00:00, 9754330.44it/s]</p></pre></div>
<div style="background-color:var(--ifm-pre-background);margin-bottom:10px;border-radius:var(--ifm-global-radius);overflow:hidden;padding:5px;font:var(--ifm-code-font-size) / var(--ifm-pre-line-height) var(--ifm-font-family-monospace)"><span style="color:red">Out: </span><pre style="margin:0px;background-color:inherit;padding:8px"><p style="margin-bottom:0px"> 79%|█████████████████████████▉       | 7798784/9912422 [00:00&lt;00:00, 9225555.09it/s]</p></pre></div>
<div style="background-color:var(--ifm-pre-background);margin-bottom:10px;border-radius:var(--ifm-global-radius);overflow:hidden;padding:5px;font:var(--ifm-code-font-size) / var(--ifm-pre-line-height) var(--ifm-font-family-monospace)"><span style="color:red">Out: </span><pre style="margin:0px;background-color:inherit;padding:8px"><p style="margin-bottom:0px"> 88%|█████████████████████████████▏   | 8749056/9912422 [00:00&lt;00:00, 9139495.92it/s]</p></pre></div>
<div style="background-color:var(--ifm-pre-background);margin-bottom:10px;border-radius:var(--ifm-global-radius);overflow:hidden;padding:5px;font:var(--ifm-code-font-size) / var(--ifm-pre-line-height) var(--ifm-font-family-monospace)"><span style="color:red">Out: </span><pre style="margin:0px;background-color:inherit;padding:8px"><p style="margin-bottom:0px"> 98%|████████████████████████████████▎| 9699328/9912422 [00:01&lt;00:00, 8784117.93it/s]</p></pre></div>
<div style="background-color:var(--ifm-pre-background);margin-bottom:10px;border-radius:var(--ifm-global-radius);overflow:hidden;padding:5px;font:var(--ifm-code-font-size) / var(--ifm-pre-line-height) var(--ifm-font-family-monospace)"><span style="color:red">Out: </span><pre style="margin:0px;background-color:inherit;padding:8px"><p style="margin-bottom:0px">100%|█████████████████████████████████| 9912422/9912422 [00:01&lt;00:00, 9512240.61it/s]</p></pre></div>
<div style="background-color:var(--ifm-pre-background);margin-bottom:10px;border-radius:var(--ifm-global-radius);overflow:hidden;padding:5px;font:var(--ifm-code-font-size) / var(--ifm-pre-line-height) var(--ifm-font-family-monospace)"><span style="color:red">Out: </span><pre style="margin:0px;background-color:inherit;padding:8px"><p style="margin-bottom:0px">Extracting ./data/MNIST/raw/train-images-idx3-ubyte.gz to ./data/MNIST/raw</p><p style="margin-bottom:0px">Downloading http://yann.lecun.com/exdb/mnist/train-labels-idx1-ubyte.gz</p><p style="margin-bottom:0px">Failed to download (trying next):</p><p style="margin-bottom:0px">HTTP Error 403: Forbidden</p><p style="margin-bottom:0px">Downloading https://ossci-datasets.s3.amazonaws.com/mnist/train-labels-idx1-ubyte.gz</p></pre></div>
<div style="background-color:var(--ifm-pre-background);margin-bottom:10px;border-radius:var(--ifm-global-radius);overflow:hidden;padding:5px;font:var(--ifm-code-font-size) / var(--ifm-pre-line-height) var(--ifm-font-family-monospace)"><span style="color:red">Out: </span><pre style="margin:0px;background-color:inherit;padding:8px"><p style="margin-bottom:0px">Downloading https://ossci-datasets.s3.amazonaws.com/mnist/train-labels-idx1-ubyte.gz to ./data/MNIST/raw/train-labels-idx1-ubyte.gz</p></pre></div>
<div style="background-color:var(--ifm-pre-background);margin-bottom:10px;border-radius:var(--ifm-global-radius);overflow:hidden;padding:5px;font:var(--ifm-code-font-size) / var(--ifm-pre-line-height) var(--ifm-font-family-monospace)"><span style="color:red">Out: </span><pre style="margin:0px;background-color:inherit;padding:8px"><p style="margin-bottom:0px">  0%|                                                      | 0/28881 [00:00&lt;?, ?it/s]</p></pre></div>
<div style="background-color:var(--ifm-pre-background);margin-bottom:10px;border-radius:var(--ifm-global-radius);overflow:hidden;padding:5px;font:var(--ifm-code-font-size) / var(--ifm-pre-line-height) var(--ifm-font-family-monospace)"><span style="color:red">Out: </span><pre style="margin:0px;background-color:inherit;padding:8px"><p style="margin-bottom:0px">100%|█████████████████████████████████████| 28881/28881 [00:00&lt;00:00, 2988201.04it/s]</p></pre></div>
<div style="background-color:var(--ifm-pre-background);margin-bottom:10px;border-radius:var(--ifm-global-radius);overflow:hidden;padding:5px;font:var(--ifm-code-font-size) / var(--ifm-pre-line-height) var(--ifm-font-family-monospace)"><span style="color:red">Out: </span><pre style="margin:0px;background-color:inherit;padding:8px"><p style="margin-bottom:0px">Extracting ./data/MNIST/raw/train-labels-idx1-ubyte.gz to ./data/MNIST/raw</p><p style="margin-bottom:0px">Downloading http://yann.lecun.com/exdb/mnist/t10k-images-idx3-ubyte.gz</p><p style="margin-bottom:0px">Failed to download (trying next):</p><p style="margin-bottom:0px">HTTP Error 403: Forbidden</p><p style="margin-bottom:0px">Downloading https://ossci-datasets.s3.amazonaws.com/mnist/t10k-images-idx3-ubyte.gz</p></pre></div>
<div style="background-color:var(--ifm-pre-background);margin-bottom:10px;border-radius:var(--ifm-global-radius);overflow:hidden;padding:5px;font:var(--ifm-code-font-size) / var(--ifm-pre-line-height) var(--ifm-font-family-monospace)"><span style="color:red">Out: </span><pre style="margin:0px;background-color:inherit;padding:8px"><p style="margin-bottom:0px">Downloading https://ossci-datasets.s3.amazonaws.com/mnist/t10k-images-idx3-ubyte.gz to ./data/MNIST/raw/t10k-images-idx3-ubyte.gz</p></pre></div>
<div style="background-color:var(--ifm-pre-background);margin-bottom:10px;border-radius:var(--ifm-global-radius);overflow:hidden;padding:5px;font:var(--ifm-code-font-size) / var(--ifm-pre-line-height) var(--ifm-font-family-monospace)"><span style="color:red">Out: </span><pre style="margin:0px;background-color:inherit;padding:8px"><p style="margin-bottom:0px">  0%|                                                    | 0/1648877 [00:00&lt;?, ?it/s]</p></pre></div>
<div style="background-color:var(--ifm-pre-background);margin-bottom:10px;border-radius:var(--ifm-global-radius);overflow:hidden;padding:5px;font:var(--ifm-code-font-size) / var(--ifm-pre-line-height) var(--ifm-font-family-monospace)"><span style="color:red">Out: </span><pre style="margin:0px;background-color:inherit;padding:8px"><p style="margin-bottom:0px"> 60%|████████████████████▎             | 983040/1648877 [00:00&lt;00:00, 9783129.96it/s]</p></pre></div>
<div style="background-color:var(--ifm-pre-background);margin-bottom:10px;border-radius:var(--ifm-global-radius);overflow:hidden;padding:5px;font:var(--ifm-code-font-size) / var(--ifm-pre-line-height) var(--ifm-font-family-monospace)"><span style="color:red">Out: </span><pre style="margin:0px;background-color:inherit;padding:8px"><p style="margin-bottom:0px">100%|█████████████  ████████████████████| 1648877/1648877 [00:00&lt;00:00, 4786597.45it/s]</p></pre></div>
<div style="background-color:var(--ifm-pre-background);margin-bottom:10px;border-radius:var(--ifm-global-radius);overflow:hidden;padding:5px;font:var(--ifm-code-font-size) / var(--ifm-pre-line-height) var(--ifm-font-family-monospace)"><span style="color:red">Out: </span><pre style="margin:0px;background-color:inherit;padding:8px"><p style="margin-bottom:0px">Extracting ./data/MNIST/raw/t10k-images-idx3-ubyte.gz to ./data/MNIST/raw</p><p style="margin-bottom:0px">Downloading http://yann.lecun.com/exdb/mnist/t10k-labels-idx1-ubyte.gz</p><p style="margin-bottom:0px">Failed to download (trying next):</p><p style="margin-bottom:0px">HTTP Error 403: Forbidden</p><p style="margin-bottom:0px">Downloading https://ossci-datasets.s3.amazonaws.com/mnist/t10k-labels-idx1-ubyte.gz</p><p style="margin-bottom:0px">Downloading https://ossci-datasets.s3.amazonaws.com/mnist/t10k-labels-idx1-ubyte.gz to ./data/MNIST/raw/t10k-labels-idx1-ubyte.gz</p></pre></div>
<div style="background-color:var(--ifm-pre-background);margin-bottom:10px;border-radius:var(--ifm-global-radius);overflow:hidden;padding:5px;font:var(--ifm-code-font-size) / var(--ifm-pre-line-height) var(--ifm-font-family-monospace)"><span style="color:red">Out: </span><pre style="margin:0px;background-color:inherit;padding:8px"><p style="margin-bottom:0px">  0%|                                                       | 0/4542 [00:00&lt;?, ?it/s]</p></pre></div>
<div style="background-color:var(--ifm-pre-background);margin-bottom:10px;border-radius:var(--ifm-global-radius);overflow:hidden;padding:5px;font:var(--ifm-code-font-size) / var(--ifm-pre-line-height) var(--ifm-font-family-monospace)"><span style="color:red">Out: </span><pre style="margin:0px;background-color:inherit;padding:8px"><p style="margin-bottom:0px">100%|███████████████████████████████████████| 4542/4542 [00:00&lt;00:00, 2998194.64it/s]</p></pre></div>
<div style="background-color:var(--ifm-pre-background);margin-bottom:10px;border-radius:var(--ifm-global-radius);overflow:hidden;padding:5px;font:var(--ifm-code-font-size) / var(--ifm-pre-line-height) var(--ifm-font-family-monospace)"><span style="color:red">Out: </span><pre style="margin:0px;background-color:inherit;padding:8px"><p style="margin-bottom:0px">Extracting ./data/MNIST/raw/t10k-labels-idx1-ubyte.gz to ./data/MNIST/raw</p></pre></div>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="2-initialize-client">2. Initialize Client<a href="#2-initialize-client" class="hash-link" aria-label="Direct link to 2. Initialize Client" title="Direct link to 2. Initialize Client">​</a></h2>
<p>Create a client object to interface with Ax APIs. By default this runs locally without
storage.</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">ax_client </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> AxClient</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div style="background-color:var(--ifm-pre-background);margin-bottom:10px;border-radius:var(--ifm-global-radius);overflow:hidden;padding:5px;font:var(--ifm-code-font-size) / var(--ifm-pre-line-height) var(--ifm-font-family-monospace)"><span style="color:red">Out: </span><pre style="margin:0px;background-color:inherit;padding:8px"><p style="margin-bottom:0px">[INFO 09-29 17:03:05] ax.service.ax_client: Starting optimization with verbose logging. To disable logging, set the verbose_logging argument to False. Note that float values in the logs are rounded to 6 decimal points.</p></pre></div>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="3-set-up-experiment">3. Set up experiment<a href="#3-set-up-experiment" class="hash-link" aria-label="Direct link to 3. Set up experiment" title="Direct link to 3. Set up experiment">​</a></h2>
<p>An experiment consists of a <strong>search space</strong> (parameters and parameter constraints) and
<strong>optimization configuration</strong> (objective name, minimization setting, and outcome
constraints).</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># Create an experiment with required arguments: name, parameters, and objective_name.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">ax_client</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">create_experiment</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    name</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;tune_cnn_on_mnist&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># The name of the experiment.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    parameters</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;name&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;lr&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># The name of the parameter.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;type&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;range&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># The type of the parameter (&quot;range&quot;, &quot;choice&quot; or &quot;fixed&quot;).</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;bounds&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token number" style="color:rgb(247, 140, 108)">1e-6</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0.4</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># The bounds for range parameters. </span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># &quot;values&quot; The possible values for choice parameters .</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># &quot;value&quot; The fixed value for fixed parameters.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;value_type&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;float&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># Optional, the value type (&quot;int&quot;, &quot;float&quot;, &quot;bool&quot; or &quot;str&quot;). Defaults to inference from type of &quot;bounds&quot;.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;log_scale&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">True</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># Optional, whether to use a log scale for range parameters. Defaults to False.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># &quot;is_ordered&quot; Optional, a flag for choice parameters.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;name&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;momentum&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain">  </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;type&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;range&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain">  </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;bounds&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token number" style="color:rgb(247, 140, 108)">0.0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1.0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain">  </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    objectives</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;accuracy&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> ObjectiveProperties</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">minimize</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token boolean" style="color:rgb(255, 88, 116)">False</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># The objective name and minimization setting.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># parameter_constraints: Optional, a list of strings of form &quot;p1 &gt;= p2&quot; or &quot;p1 + p2 &lt;= some_bound&quot;.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># outcome_constraints: Optional, a list of strings of form &quot;constrained_metric &lt;= some_bound&quot;.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div style="background-color:var(--ifm-pre-background);margin-bottom:10px;border-radius:var(--ifm-global-radius);overflow:hidden;padding:5px;font:var(--ifm-code-font-size) / var(--ifm-pre-line-height) var(--ifm-font-family-monospace)"><span style="color:red">Out: </span><pre style="margin:0px;background-color:inherit;padding:8px"><p style="margin-bottom:0px">[INFO 09-29 17:03:05] ax.service.utils.instantiation: Inferred value type of ParameterType.FLOAT for parameter momentum. If that is not the expected value type, you can explicitly specify &#x27;value_type&#x27; (&#x27;int&#x27;, &#x27;float&#x27;, &#x27;bool&#x27; or &#x27;str&#x27;) in parameter dict.</p></pre></div>
<div style="background-color:var(--ifm-pre-background);margin-bottom:10px;border-radius:var(--ifm-global-radius);overflow:hidden;padding:5px;font:var(--ifm-code-font-size) / var(--ifm-pre-line-height) var(--ifm-font-family-monospace)"><span style="color:red">Out: </span><pre style="margin:0px;background-color:inherit;padding:8px"><p style="margin-bottom:0px">[INFO 09-29 17:03:05] ax.service.utils.instantiation: Created search space: SearchSpace(parameters=[RangeParameter(name=&#x27;lr&#x27;, parameter_type=FLOAT, range=[1e-06, 0.4], log_scale=True), RangeParameter(name=&#x27;momentum&#x27;, parameter_type=FLOAT, range=[0.0, 1.0])], parameter_constraints=[]).</p></pre></div>
<div style="background-color:var(--ifm-pre-background);margin-bottom:10px;border-radius:var(--ifm-global-radius);overflow:hidden;padding:5px;font:var(--ifm-code-font-size) / var(--ifm-pre-line-height) var(--ifm-font-family-monospace)"><span style="color:red">Out: </span><pre style="margin:0px;background-color:inherit;padding:8px"><p style="margin-bottom:0px">[INFO 09-29 17:03:05] ax.modelbridge.dispatch_utils: Using Models.BOTORCH_MODULAR since there is at least one ordered parameter and there are no unordered categorical parameters.</p></pre></div>
<div style="background-color:var(--ifm-pre-background);margin-bottom:10px;border-radius:var(--ifm-global-radius);overflow:hidden;padding:5px;font:var(--ifm-code-font-size) / var(--ifm-pre-line-height) var(--ifm-font-family-monospace)"><span style="color:red">Out: </span><pre style="margin:0px;background-color:inherit;padding:8px"><p style="margin-bottom:0px">[INFO 09-29 17:03:05] ax.modelbridge.dispatch_utils: Calculating the number of remaining initialization trials based on num_initialization_trials=None max_initialization_trials=None num_tunable_parameters=2 num_trials=None use_batch_trials=False</p></pre></div>
<div style="background-color:var(--ifm-pre-background);margin-bottom:10px;border-radius:var(--ifm-global-radius);overflow:hidden;padding:5px;font:var(--ifm-code-font-size) / var(--ifm-pre-line-height) var(--ifm-font-family-monospace)"><span style="color:red">Out: </span><pre style="margin:0px;background-color:inherit;padding:8px"><p style="margin-bottom:0px">[INFO 09-29 17:03:05] ax.modelbridge.dispatch_utils: calculated num_initialization_trials=5</p></pre></div>
<div style="background-color:var(--ifm-pre-background);margin-bottom:10px;border-radius:var(--ifm-global-radius);overflow:hidden;padding:5px;font:var(--ifm-code-font-size) / var(--ifm-pre-line-height) var(--ifm-font-family-monospace)"><span style="color:red">Out: </span><pre style="margin:0px;background-color:inherit;padding:8px"><p style="margin-bottom:0px">[INFO 09-29 17:03:05] ax.modelbridge.dispatch_utils: num_completed_initialization_trials=0 num_remaining_initialization_trials=5</p></pre></div>
<div style="background-color:var(--ifm-pre-background);margin-bottom:10px;border-radius:var(--ifm-global-radius);overflow:hidden;padding:5px;font:var(--ifm-code-font-size) / var(--ifm-pre-line-height) var(--ifm-font-family-monospace)"><span style="color:red">Out: </span><pre style="margin:0px;background-color:inherit;padding:8px"><p style="margin-bottom:0px">[INFO 09-29 17:03:05] ax.modelbridge.dispatch_utils: verbose, disable_progbar, and jit_compile are not yet supported when using choose_generation_strategy with ModularBoTorchModel, dropping these arguments.</p></pre></div>
<div style="background-color:var(--ifm-pre-background);margin-bottom:10px;border-radius:var(--ifm-global-radius);overflow:hidden;padding:5px;font:var(--ifm-code-font-size) / var(--ifm-pre-line-height) var(--ifm-font-family-monospace)"><span style="color:red">Out: </span><pre style="margin:0px;background-color:inherit;padding:8px"><p style="margin-bottom:0px">[INFO 09-29 17:03:05] ax.modelbridge.dispatch_utils: Using Bayesian Optimization generation strategy: GenerationStrategy(name=&#x27;Sobol+BoTorch&#x27;, steps=[Sobol for 5 trials, BoTorch for subsequent trials]). Iterations after 5 will take longer to generate due to model-fitting.</p></pre></div>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="4-define-how-to-evaluate-trials">4. Define how to evaluate trials<a href="#4-define-how-to-evaluate-trials" class="hash-link" aria-label="Direct link to 4. Define how to evaluate trials" title="Direct link to 4. Define how to evaluate trials">​</a></h2>
<p>First we define a simple CNN class to classify the MNIST images</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">class</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">CNN</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">nn</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">Module</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">__init__</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">None</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token builtin" style="color:rgb(130, 170, 255)">super</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">__init__</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        self</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">conv1 </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> nn</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">Conv2d</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">20</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> kernel_size</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token number" style="color:rgb(247, 140, 108)">5</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> stride</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        self</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">fc1 </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> nn</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">Linear</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">8</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">8</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">20</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">64</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        self</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">fc2 </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> nn</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">Linear</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">64</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">10</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">forward</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> x</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> Tensor</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"> Tensor</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        x </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> F</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">relu</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">conv1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">x</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        x </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> F</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">max_pool2d</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">x</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">3</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">3</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        x </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> x</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">view</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">8</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">8</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">20</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        x </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> F</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">relu</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">fc1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">x</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        x </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> self</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">fc2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">x</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token keyword" style="font-style:italic">return</span><span class="token plain"> F</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">log_softmax</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">x</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> dim</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>In this tutorial, we want to optimize classification accuracy on the validation set as a
function of the learning rate and momentum. The <code>train_evaluate</code> function takes in a
parameterization (set of parameter values), computes the classification accuracy, and
returns that metric.</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">train_evaluate</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">parameterization</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token triple-quoted-string string" style="color:rgb(195, 232, 141)">&quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token triple-quoted-string string" style="color:rgb(195, 232, 141)">    Train the model and then compute an evaluation metric.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token triple-quoted-string string" style="display:inline-block;color:rgb(195, 232, 141)"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token triple-quoted-string string" style="color:rgb(195, 232, 141)">    In this tutorial, the CNN utils package is doing a lot of work</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token triple-quoted-string string" style="color:rgb(195, 232, 141)">    under the hood:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token triple-quoted-string string" style="color:rgb(195, 232, 141)">        - `train` initializes the network, defines the loss function</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token triple-quoted-string string" style="color:rgb(195, 232, 141)">        and optimizer, performs the training loop, and returns the</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token triple-quoted-string string" style="color:rgb(195, 232, 141)">        trained model.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token triple-quoted-string string" style="color:rgb(195, 232, 141)">        - `evaluate` computes the accuracy of the model on the</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token triple-quoted-string string" style="color:rgb(195, 232, 141)">        evaluation dataset and returns the metric.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token triple-quoted-string string" style="display:inline-block;color:rgb(195, 232, 141)"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token triple-quoted-string string" style="color:rgb(195, 232, 141)">    For your use case, you can define training and evaluation functions</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token triple-quoted-string string" style="color:rgb(195, 232, 141)">    of your choosing.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token triple-quoted-string string" style="display:inline-block;color:rgb(195, 232, 141)"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token triple-quoted-string string" style="color:rgb(195, 232, 141)">    &quot;&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    net </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> CNN</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    net </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> train</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        net</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">net</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        train_loader</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">train_loader</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        parameters</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">parameterization</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        dtype</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">dtype</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        device</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">device</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">return</span><span class="token plain"> evaluate</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        net</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">net</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        data_loader</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">valid_loader</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        dtype</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">dtype</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        device</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">device</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="5-run-optimization-loop">5. Run optimization loop<a href="#5-run-optimization-loop" class="hash-link" aria-label="Direct link to 5. Run optimization loop" title="Direct link to 5. Run optimization loop">​</a></h2>
<p>First we use <code>attach_trial</code> to attach a custom trial with manually-chosen parameters.
This step is optional, but we include it here to demonstrate adding manual trials and to
serve as a baseline model with decent performance.</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># Attach the trial</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">ax_client</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">attach_trial</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    parameters</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;lr&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0.000026</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;momentum&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0.58</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># Get the parameters and run the trial </span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">baseline_parameters </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> ax_client</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">get_trial_parameters</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">trial_index</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">ax_client</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">complete_trial</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">trial_index</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> raw_data</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">train_evaluate</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">baseline_parameters</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div style="background-color:var(--ifm-pre-background);margin-bottom:10px;border-radius:var(--ifm-global-radius);overflow:hidden;padding:5px;font:var(--ifm-code-font-size) / var(--ifm-pre-line-height) var(--ifm-font-family-monospace)"><span style="color:red">Out: </span><pre style="margin:0px;background-color:inherit;padding:8px"><p style="margin-bottom:0px">[INFO 09-29 17:03:06] ax.core.experiment: Attached custom parameterizations [{&#x27;lr&#x27;: 2.6e-05, &#x27;momentum&#x27;: 0.58}] as trial 0.</p></pre></div>
<div style="background-color:var(--ifm-pre-background);margin-bottom:10px;border-radius:var(--ifm-global-radius);overflow:hidden;padding:5px;font:var(--ifm-code-font-size) / var(--ifm-pre-line-height) var(--ifm-font-family-monospace)"><span style="color:red">Out: </span><pre style="margin:0px;background-color:inherit;padding:8px"><p style="margin-bottom:0px">[INFO 09-29 17:03:09] ax.service.ax_client: Completed trial 0 with data: {&#x27;accuracy&#x27;: (0.841833, None)}.</p></pre></div>
<p>Now we start the optimization loop.</p>
<p>At each step, the user queries the client for a new trial then submits the evaluation of
that trial back to the client.</p>
<p>Note that Ax auto-selects an appropriate optimization algorithm based on the search
space. For more advanced use cases that require a specific optimization algorithm, pass
a <code>generation_strategy</code> argument into the <code>AxClient</code> constructor. Note that when
Bayesian Optimization is used, generating new trials may take a few minutes.</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">for</span><span class="token plain"> i </span><span class="token keyword" style="font-style:italic">in</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(130, 170, 255)">range</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">25</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    parameters</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> trial_index </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> ax_client</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">get_next_trial</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># Local evaluation here can be replaced with deployment to external system.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    ax_client</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">complete_trial</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">trial_index</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">trial_index</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> raw_data</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">train_evaluate</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">parameters</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div style="background-color:var(--ifm-pre-background);margin-bottom:10px;border-radius:var(--ifm-global-radius);overflow:hidden;padding:5px;font:var(--ifm-code-font-size) / var(--ifm-pre-line-height) var(--ifm-font-family-monospace)"><span style="color:red">Out: </span><pre style="margin:0px;background-color:inherit;padding:8px"><p style="margin-bottom:0px">/Users/cristianlara/Projects/Ax-1.0/ax/modelbridge/cross_validation.py:463: UserWarning:</p><p style="margin-bottom:0px">Encountered exception in computing model fit quality: RandomModelBridge does not support prediction.</p><p style="margin-bottom:0px">[INFO 09-29 17:03:10] ax.service.ax_client: Generated new trial 1 with parameters {&#x27;lr&#x27;: 0.009955, &#x27;momentum&#x27;: 0.633423} using model Sobol.</p></pre></div>
<div style="background-color:var(--ifm-pre-background);margin-bottom:10px;border-radius:var(--ifm-global-radius);overflow:hidden;padding:5px;font:var(--ifm-code-font-size) / var(--ifm-pre-line-height) var(--ifm-font-family-monospace)"><span style="color:red">Out: </span><pre style="margin:0px;background-color:inherit;padding:8px"><p style="margin-bottom:0px">[INFO 09-29 17:03:14] ax.service.ax_client: Completed trial 1 with data: {&#x27;accuracy&#x27;: (0.100333, None)}.</p></pre></div>
<div style="background-color:var(--ifm-pre-background);margin-bottom:10px;border-radius:var(--ifm-global-radius);overflow:hidden;padding:5px;font:var(--ifm-code-font-size) / var(--ifm-pre-line-height) var(--ifm-font-family-monospace)"><span style="color:red">Out: </span><pre style="margin:0px;background-color:inherit;padding:8px"><p style="margin-bottom:0px">/Users/cristianlara/Projects/Ax-1.0/ax/modelbridge/cross_validation.py:463: UserWarning:</p><p style="margin-bottom:0px">Encountered exception in computing model fit quality: RandomModelBridge does not support prediction.</p><p style="margin-bottom:0px">[INFO 09-29 17:03:14] ax.service.ax_client: Generated new trial 2 with parameters {&#x27;lr&#x27;: 9e-05, &#x27;momentum&#x27;: 0.335441} using model Sobol.</p></pre></div>
<div style="background-color:var(--ifm-pre-background);margin-bottom:10px;border-radius:var(--ifm-global-radius);overflow:hidden;padding:5px;font:var(--ifm-code-font-size) / var(--ifm-pre-line-height) var(--ifm-font-family-monospace)"><span style="color:red">Out: </span><pre style="margin:0px;background-color:inherit;padding:8px"><p style="margin-bottom:0px">[INFO 09-29 17:03:18] ax.service.ax_client: Completed trial 2 with data: {&#x27;accuracy&#x27;: (0.884167, None)}.</p></pre></div>
<div style="background-color:var(--ifm-pre-background);margin-bottom:10px;border-radius:var(--ifm-global-radius);overflow:hidden;padding:5px;font:var(--ifm-code-font-size) / var(--ifm-pre-line-height) var(--ifm-font-family-monospace)"><span style="color:red">Out: </span><pre style="margin:0px;background-color:inherit;padding:8px"><p style="margin-bottom:0px">/Users/cristianlara/Projects/Ax-1.0/ax/modelbridge/cross_validation.py:463: UserWarning:</p><p style="margin-bottom:0px">Encountered exception in computing model fit quality: RandomModelBridge does not support prediction.</p><p style="margin-bottom:0px">[INFO 09-29 17:03:18] ax.service.ax_client: Generated new trial 3 with parameters {&#x27;lr&#x27;: 2e-06, &#x27;momentum&#x27;: 0.902833} using model Sobol.</p></pre></div>
<div style="background-color:var(--ifm-pre-background);margin-bottom:10px;border-radius:var(--ifm-global-radius);overflow:hidden;padding:5px;font:var(--ifm-code-font-size) / var(--ifm-pre-line-height) var(--ifm-font-family-monospace)"><span style="color:red">Out: </span><pre style="margin:0px;background-color:inherit;padding:8px"><p style="margin-bottom:0px">[INFO 09-29 17:03:23] ax.service.ax_client: Completed trial 3 with data: {&#x27;accuracy&#x27;: (0.678667, None)}.</p></pre></div>
<div style="background-color:var(--ifm-pre-background);margin-bottom:10px;border-radius:var(--ifm-global-radius);overflow:hidden;padding:5px;font:var(--ifm-code-font-size) / var(--ifm-pre-line-height) var(--ifm-font-family-monospace)"><span style="color:red">Out: </span><pre style="margin:0px;background-color:inherit;padding:8px"><p style="margin-bottom:0px">/Users/cristianlara/Projects/Ax-1.0/ax/modelbridge/cross_validation.py:463: UserWarning:</p><p style="margin-bottom:0px">Encountered exception in computing model fit quality: RandomModelBridge does not support prediction.</p><p style="margin-bottom:0px">[INFO 09-29 17:03:23] ax.service.ax_client: Generated new trial 4 with parameters {&#x27;lr&#x27;: 0.10174, &#x27;momentum&#x27;: 0.065787} using model Sobol.</p></pre></div>
<div style="background-color:var(--ifm-pre-background);margin-bottom:10px;border-radius:var(--ifm-global-radius);overflow:hidden;padding:5px;font:var(--ifm-code-font-size) / var(--ifm-pre-line-height) var(--ifm-font-family-monospace)"><span style="color:red">Out: </span><pre style="margin:0px;background-color:inherit;padding:8px"><p style="margin-bottom:0px">[INFO 09-29 17:03:25] ax.service.ax_client: Completed trial 4 with data: {&#x27;accuracy&#x27;: (0.100333, None)}.</p></pre></div>
<div style="background-color:var(--ifm-pre-background);margin-bottom:10px;border-radius:var(--ifm-global-radius);overflow:hidden;padding:5px;font:var(--ifm-code-font-size) / var(--ifm-pre-line-height) var(--ifm-font-family-monospace)"><span style="color:red">Out: </span><pre style="margin:0px;background-color:inherit;padding:8px"><p style="margin-bottom:0px">/Users/cristianlara/Projects/Ax-1.0/ax/modelbridge/cross_validation.py:463: UserWarning:</p><p style="margin-bottom:0px">Encountered exception in computing model fit quality: RandomModelBridge does not support prediction.</p><p style="margin-bottom:0px">[INFO 09-29 17:03:25] ax.service.ax_client: Generated new trial 5 with parameters {&#x27;lr&#x27;: 0.017004, &#x27;momentum&#x27;: 0.802601} using model Sobol.</p></pre></div>
<div style="background-color:var(--ifm-pre-background);margin-bottom:10px;border-radius:var(--ifm-global-radius);overflow:hidden;padding:5px;font:var(--ifm-code-font-size) / var(--ifm-pre-line-height) var(--ifm-font-family-monospace)"><span style="color:red">Out: </span><pre style="margin:0px;background-color:inherit;padding:8px"><p style="margin-bottom:0px">[INFO 09-29 17:03:31] ax.service.ax_client: Completed trial 5 with data: {&#x27;accuracy&#x27;: (0.088167, None)}.</p></pre></div>
<div style="background-color:var(--ifm-pre-background);margin-bottom:10px;border-radius:var(--ifm-global-radius);overflow:hidden;padding:5px;font:var(--ifm-code-font-size) / var(--ifm-pre-line-height) var(--ifm-font-family-monospace)"><span style="color:red">Out: </span><pre style="margin:0px;background-color:inherit;padding:8px"><p style="margin-bottom:0px">[INFO 09-29 17:03:31] ax.service.ax_client: Generated new trial 6 with parameters {&#x27;lr&#x27;: 3.5e-05, &#x27;momentum&#x27;: 0.0} using model BoTorch.</p></pre></div>
<div style="background-color:var(--ifm-pre-background);margin-bottom:10px;border-radius:var(--ifm-global-radius);overflow:hidden;padding:5px;font:var(--ifm-code-font-size) / var(--ifm-pre-line-height) var(--ifm-font-family-monospace)"><span style="color:red">Out: </span><pre style="margin:0px;background-color:inherit;padding:8px"><p style="margin-bottom:0px">[INFO 09-29 17:03:36] ax.service.ax_client: Completed trial 6 with data: {&#x27;accuracy&#x27;: (0.756167, None)}.</p></pre></div>
<div style="background-color:var(--ifm-pre-background);margin-bottom:10px;border-radius:var(--ifm-global-radius);overflow:hidden;padding:5px;font:var(--ifm-code-font-size) / var(--ifm-pre-line-height) var(--ifm-font-family-monospace)"><span style="color:red">Out: </span><pre style="margin:0px;background-color:inherit;padding:8px"><p style="margin-bottom:0px">[INFO 09-29 17:03:36] ax.service.ax_client: Generated new trial 7 with parameters {&#x27;lr&#x27;: 8.5e-05, &#x27;momentum&#x27;: 1.0} using model BoTorch.</p></pre></div>
<div style="background-color:var(--ifm-pre-background);margin-bottom:10px;border-radius:var(--ifm-global-radius);overflow:hidden;padding:5px;font:var(--ifm-code-font-size) / var(--ifm-pre-line-height) var(--ifm-font-family-monospace)"><span style="color:red">Out: </span><pre style="margin:0px;background-color:inherit;padding:8px"><p style="margin-bottom:0px">[INFO 09-29 17:03:41] ax.service.ax_client: Completed trial 7 with data: {&#x27;accuracy&#x27;: (0.908, None)}.</p></pre></div>
<div style="background-color:var(--ifm-pre-background);margin-bottom:10px;border-radius:var(--ifm-global-radius);overflow:hidden;padding:5px;font:var(--ifm-code-font-size) / var(--ifm-pre-line-height) var(--ifm-font-family-monospace)"><span style="color:red">Out: </span><pre style="margin:0px;background-color:inherit;padding:8px"><p style="margin-bottom:0px">[INFO 09-29 17:03:41] ax.service.ax_client: Generated new trial 8 with parameters {&#x27;lr&#x27;: 4.7e-05, &#x27;momentum&#x27;: 1.0} using model BoTorch.</p></pre></div>
<div style="background-color:var(--ifm-pre-background);margin-bottom:10px;border-radius:var(--ifm-global-radius);overflow:hidden;padding:5px;font:var(--ifm-code-font-size) / var(--ifm-pre-line-height) var(--ifm-font-family-monospace)"><span style="color:red">Out: </span><pre style="margin:0px;background-color:inherit;padding:8px"><p style="margin-bottom:0px">[INFO 09-29 17:03:46] ax.service.ax_client: Completed trial 8 with data: {&#x27;accuracy&#x27;: (0.7935, None)}.</p></pre></div>
<div style="background-color:var(--ifm-pre-background);margin-bottom:10px;border-radius:var(--ifm-global-radius);overflow:hidden;padding:5px;font:var(--ifm-code-font-size) / var(--ifm-pre-line-height) var(--ifm-font-family-monospace)"><span style="color:red">Out: </span><pre style="margin:0px;background-color:inherit;padding:8px"><p style="margin-bottom:0px">[INFO 09-29 17:03:46] ax.service.ax_client: Generated new trial 9 with parameters {&#x27;lr&#x27;: 0.000186, &#x27;momentum&#x27;: 0.914201} using model BoTorch.</p></pre></div>
<div style="background-color:var(--ifm-pre-background);margin-bottom:10px;border-radius:var(--ifm-global-radius);overflow:hidden;padding:5px;font:var(--ifm-code-font-size) / var(--ifm-pre-line-height) var(--ifm-font-family-monospace)"><span style="color:red">Out: </span><pre style="margin:0px;background-color:inherit;padding:8px"><p style="margin-bottom:0px">[INFO 09-29 17:03:51] ax.service.ax_client: Completed trial 9 with data: {&#x27;accuracy&#x27;: (0.821333, None)}.</p></pre></div>
<div style="background-color:var(--ifm-pre-background);margin-bottom:10px;border-radius:var(--ifm-global-radius);overflow:hidden;padding:5px;font:var(--ifm-code-font-size) / var(--ifm-pre-line-height) var(--ifm-font-family-monospace)"><span style="color:red">Out: </span><pre style="margin:0px;background-color:inherit;padding:8px"><p style="margin-bottom:0px">[INFO 09-29 17:03:51] ax.service.ax_client: Generated new trial 10 with parameters {&#x27;lr&#x27;: 0.000155, &#x27;momentum&#x27;: 0.0} using model BoTorch.</p></pre></div>
<div style="background-color:var(--ifm-pre-background);margin-bottom:10px;border-radius:var(--ifm-global-radius);overflow:hidden;padding:5px;font:var(--ifm-code-font-size) / var(--ifm-pre-line-height) var(--ifm-font-family-monospace)"><span style="color:red">Out: </span><pre style="margin:0px;background-color:inherit;padding:8px"><p style="margin-bottom:0px">[INFO 09-29 17:03:56] ax.service.ax_client: Completed trial 10 with data: {&#x27;accuracy&#x27;: (0.855333, None)}.</p></pre></div>
<div style="background-color:var(--ifm-pre-background);margin-bottom:10px;border-radius:var(--ifm-global-radius);overflow:hidden;padding:5px;font:var(--ifm-code-font-size) / var(--ifm-pre-line-height) var(--ifm-font-family-monospace)"><span style="color:red">Out: </span><pre style="margin:0px;background-color:inherit;padding:8px"><p style="margin-bottom:0px">[INFO 09-29 17:03:57] ax.service.ax_client: Generated new trial 11 with parameters {&#x27;lr&#x27;: 9.7e-05, &#x27;momentum&#x27;: 0.0} using model BoTorch.</p></pre></div>
<div style="background-color:var(--ifm-pre-background);margin-bottom:10px;border-radius:var(--ifm-global-radius);overflow:hidden;padding:5px;font:var(--ifm-code-font-size) / var(--ifm-pre-line-height) var(--ifm-font-family-monospace)"><span style="color:red">Out: </span><pre style="margin:0px;background-color:inherit;padding:8px"><p style="margin-bottom:0px">[INFO 09-29 17:04:00] ax.service.ax_client: Completed trial 11 with data: {&#x27;accuracy&#x27;: (0.847833, None)}.</p></pre></div>
<div style="background-color:var(--ifm-pre-background);margin-bottom:10px;border-radius:var(--ifm-global-radius);overflow:hidden;padding:5px;font:var(--ifm-code-font-size) / var(--ifm-pre-line-height) var(--ifm-font-family-monospace)"><span style="color:red">Out: </span><pre style="margin:0px;background-color:inherit;padding:8px"><p style="margin-bottom:0px">[INFO 09-29 17:04:00] ax.service.ax_client: Generated new trial 12 with parameters {&#x27;lr&#x27;: 0.000121, &#x27;momentum&#x27;: 1.0} using model BoTorch.</p></pre></div>
<div style="background-color:var(--ifm-pre-background);margin-bottom:10px;border-radius:var(--ifm-global-radius);overflow:hidden;padding:5px;font:var(--ifm-code-font-size) / var(--ifm-pre-line-height) var(--ifm-font-family-monospace)"><span style="color:red">Out: </span><pre style="margin:0px;background-color:inherit;padding:8px"><p style="margin-bottom:0px">[INFO 09-29 17:04:04] ax.service.ax_client: Completed trial 12 with data: {&#x27;accuracy&#x27;: (0.850333, None)}.</p></pre></div>
<div style="background-color:var(--ifm-pre-background);margin-bottom:10px;border-radius:var(--ifm-global-radius);overflow:hidden;padding:5px;font:var(--ifm-code-font-size) / var(--ifm-pre-line-height) var(--ifm-font-family-monospace)"><span style="color:red">Out: </span><pre style="margin:0px;background-color:inherit;padding:8px"><p style="margin-bottom:0px">[INFO 09-29 17:04:04] ax.service.ax_client: Generated new trial 13 with parameters {&#x27;lr&#x27;: 0.000116, &#x27;momentum&#x27;: 0.52957} using model BoTorch.</p></pre></div>
<div style="background-color:var(--ifm-pre-background);margin-bottom:10px;border-radius:var(--ifm-global-radius);overflow:hidden;padding:5px;font:var(--ifm-code-font-size) / var(--ifm-pre-line-height) var(--ifm-font-family-monospace)"><span style="color:red">Out: </span><pre style="margin:0px;background-color:inherit;padding:8px"><p style="margin-bottom:0px">[INFO 09-29 17:04:07] ax.service.ax_client: Completed trial 13 with data: {&#x27;accuracy&#x27;: (0.917833, None)}.</p></pre></div>
<div style="background-color:var(--ifm-pre-background);margin-bottom:10px;border-radius:var(--ifm-global-radius);overflow:hidden;padding:5px;font:var(--ifm-code-font-size) / var(--ifm-pre-line-height) var(--ifm-font-family-monospace)"><span style="color:red">Out: </span><pre style="margin:0px;background-color:inherit;padding:8px"><p style="margin-bottom:0px">[INFO 09-29 17:04:08] ax.service.ax_client: Generated new trial 14 with parameters {&#x27;lr&#x27;: 0.000174, &#x27;momentum&#x27;: 0.407224} using model BoTorch.</p></pre></div>
<div style="background-color:var(--ifm-pre-background);margin-bottom:10px;border-radius:var(--ifm-global-radius);overflow:hidden;padding:5px;font:var(--ifm-code-font-size) / var(--ifm-pre-line-height) var(--ifm-font-family-monospace)"><span style="color:red">Out: </span><pre style="margin:0px;background-color:inherit;padding:8px"><p style="margin-bottom:0px">[INFO 09-29 17:04:11] ax.service.ax_client: Completed trial 14 with data: {&#x27;accuracy&#x27;: (0.907833, None)}.</p></pre></div>
<div style="background-color:var(--ifm-pre-background);margin-bottom:10px;border-radius:var(--ifm-global-radius);overflow:hidden;padding:5px;font:var(--ifm-code-font-size) / var(--ifm-pre-line-height) var(--ifm-font-family-monospace)"><span style="color:red">Out: </span><pre style="margin:0px;background-color:inherit;padding:8px"><p style="margin-bottom:0px">[INFO 09-29 17:04:11] ax.service.ax_client: Generated new trial 15 with parameters {&#x27;lr&#x27;: 1e-06, &#x27;momentum&#x27;: 0.0} using model BoTorch.</p></pre></div>
<div style="background-color:var(--ifm-pre-background);margin-bottom:10px;border-radius:var(--ifm-global-radius);overflow:hidden;padding:5px;font:var(--ifm-code-font-size) / var(--ifm-pre-line-height) var(--ifm-font-family-monospace)"><span style="color:red">Out: </span><pre style="margin:0px;background-color:inherit;padding:8px"><p style="margin-bottom:0px">[INFO 09-29 17:04:15] ax.service.ax_client: Completed trial 15 with data: {&#x27;accuracy&#x27;: (0.167833, None)}.</p></pre></div>
<div style="background-color:var(--ifm-pre-background);margin-bottom:10px;border-radius:var(--ifm-global-radius);overflow:hidden;padding:5px;font:var(--ifm-code-font-size) / var(--ifm-pre-line-height) var(--ifm-font-family-monospace)"><span style="color:red">Out: </span><pre style="margin:0px;background-color:inherit;padding:8px"><p style="margin-bottom:0px">[INFO 09-29 17:04:16] ax.service.ax_client: Generated new trial 16 with parameters {&#x27;lr&#x27;: 8.9e-05, &#x27;momentum&#x27;: 0.520364} using model BoTorch.</p></pre></div>
<div style="background-color:var(--ifm-pre-background);margin-bottom:10px;border-radius:var(--ifm-global-radius);overflow:hidden;padding:5px;font:var(--ifm-code-font-size) / var(--ifm-pre-line-height) var(--ifm-font-family-monospace)"><span style="color:red">Out: </span><pre style="margin:0px;background-color:inherit;padding:8px"><p style="margin-bottom:0px">[INFO 09-29 17:04:20] ax.service.ax_client: Completed trial 16 with data: {&#x27;accuracy&#x27;: (0.9085, None)}.</p></pre></div>
<div style="background-color:var(--ifm-pre-background);margin-bottom:10px;border-radius:var(--ifm-global-radius);overflow:hidden;padding:5px;font:var(--ifm-code-font-size) / var(--ifm-pre-line-height) var(--ifm-font-family-monospace)"><span style="color:red">Out: </span><pre style="margin:0px;background-color:inherit;padding:8px"><p style="margin-bottom:0px">[INFO 09-29 17:04:20] ax.service.ax_client: Generated new trial 17 with parameters {&#x27;lr&#x27;: 0.000121, &#x27;momentum&#x27;: 0.420034} using model BoTorch.</p></pre></div>
<div style="background-color:var(--ifm-pre-background);margin-bottom:10px;border-radius:var(--ifm-global-radius);overflow:hidden;padding:5px;font:var(--ifm-code-font-size) / var(--ifm-pre-line-height) var(--ifm-font-family-monospace)"><span style="color:red">Out: </span><pre style="margin:0px;background-color:inherit;padding:8px"><p style="margin-bottom:0px">[INFO 09-29 17:04:24] ax.service.ax_client: Completed trial 17 with data: {&#x27;accuracy&#x27;: (0.908833, None)}.</p></pre></div>
<div style="background-color:var(--ifm-pre-background);margin-bottom:10px;border-radius:var(--ifm-global-radius);overflow:hidden;padding:5px;font:var(--ifm-code-font-size) / var(--ifm-pre-line-height) var(--ifm-font-family-monospace)"><span style="color:red">Out: </span><pre style="margin:0px;background-color:inherit;padding:8px"><p style="margin-bottom:0px">[INFO 09-29 17:04:25] ax.service.ax_client: Generated new trial 18 with parameters {&#x27;lr&#x27;: 9.3e-05, &#x27;momentum&#x27;: 0.602704} using model BoTorch.</p></pre></div>
<div style="background-color:var(--ifm-pre-background);margin-bottom:10px;border-radius:var(--ifm-global-radius);overflow:hidden;padding:5px;font:var(--ifm-code-font-size) / var(--ifm-pre-line-height) var(--ifm-font-family-monospace)"><span style="color:red">Out: </span><pre style="margin:0px;background-color:inherit;padding:8px"><p style="margin-bottom:0px">[INFO 09-29 17:04:29] ax.service.ax_client: Completed trial 18 with data: {&#x27;accuracy&#x27;: (0.904333, None)}.</p></pre></div>
<div style="background-color:var(--ifm-pre-background);margin-bottom:10px;border-radius:var(--ifm-global-radius);overflow:hidden;padding:5px;font:var(--ifm-code-font-size) / var(--ifm-pre-line-height) var(--ifm-font-family-monospace)"><span style="color:red">Out: </span><pre style="margin:0px;background-color:inherit;padding:8px"><p style="margin-bottom:0px">[INFO 09-29 17:04:30] ax.modelbridge.base: Untransformed parameter 0.40000000000000013 greater than upper bound 0.4, clamping</p></pre></div>
<div style="background-color:var(--ifm-pre-background);margin-bottom:10px;border-radius:var(--ifm-global-radius);overflow:hidden;padding:5px;font:var(--ifm-code-font-size) / var(--ifm-pre-line-height) var(--ifm-font-family-monospace)"><span style="color:red">Out: </span><pre style="margin:0px;background-color:inherit;padding:8px"><p style="margin-bottom:0px">[INFO 09-29 17:04:30] ax.service.ax_client: Generated new trial 19 with parameters {&#x27;lr&#x27;: 0.4, &#x27;momentum&#x27;: 1.0} using model BoTorch.</p></pre></div>
<div style="background-color:var(--ifm-pre-background);margin-bottom:10px;border-radius:var(--ifm-global-radius);overflow:hidden;padding:5px;font:var(--ifm-code-font-size) / var(--ifm-pre-line-height) var(--ifm-font-family-monospace)"><span style="color:red">Out: </span><pre style="margin:0px;background-color:inherit;padding:8px"><p style="margin-bottom:0px">[INFO 09-29 17:04:33] ax.service.ax_client: Completed trial 19 with data: {&#x27;accuracy&#x27;: (0.0955, None)}.</p></pre></div>
<div style="background-color:var(--ifm-pre-background);margin-bottom:10px;border-radius:var(--ifm-global-radius);overflow:hidden;padding:5px;font:var(--ifm-code-font-size) / var(--ifm-pre-line-height) var(--ifm-font-family-monospace)"><span style="color:red">Out: </span><pre style="margin:0px;background-color:inherit;padding:8px"><p style="margin-bottom:0px">[INFO 09-29 17:04:34] ax.service.ax_client: Generated new trial 20 with parameters {&#x27;lr&#x27;: 0.000101, &#x27;momentum&#x27;: 0.460781} using model BoTorch.</p></pre></div>
<div style="background-color:var(--ifm-pre-background);margin-bottom:10px;border-radius:var(--ifm-global-radius);overflow:hidden;padding:5px;font:var(--ifm-code-font-size) / var(--ifm-pre-line-height) var(--ifm-font-family-monospace)"><span style="color:red">Out: </span><pre style="margin:0px;background-color:inherit;padding:8px"><p style="margin-bottom:0px">[INFO 09-29 17:04:37] ax.service.ax_client: Completed trial 20 with data: {&#x27;accuracy&#x27;: (0.906, None)}.</p></pre></div>
<div style="background-color:var(--ifm-pre-background);margin-bottom:10px;border-radius:var(--ifm-global-radius);overflow:hidden;padding:5px;font:var(--ifm-code-font-size) / var(--ifm-pre-line-height) var(--ifm-font-family-monospace)"><span style="color:red">Out: </span><pre style="margin:0px;background-color:inherit;padding:8px"><p style="margin-bottom:0px">[INFO 09-29 17:04:37] ax.service.ax_client: Generated new trial 21 with parameters {&#x27;lr&#x27;: 0.000142, &#x27;momentum&#x27;: 0.507193} using model BoTorch.</p></pre></div>
<div style="background-color:var(--ifm-pre-background);margin-bottom:10px;border-radius:var(--ifm-global-radius);overflow:hidden;padding:5px;font:var(--ifm-code-font-size) / var(--ifm-pre-line-height) var(--ifm-font-family-monospace)"><span style="color:red">Out: </span><pre style="margin:0px;background-color:inherit;padding:8px"><p style="margin-bottom:0px">[INFO 09-29 17:04:40] ax.service.ax_client: Completed trial 21 with data: {&#x27;accuracy&#x27;: (0.922167, None)}.</p></pre></div>
<div style="background-color:var(--ifm-pre-background);margin-bottom:10px;border-radius:var(--ifm-global-radius);overflow:hidden;padding:5px;font:var(--ifm-code-font-size) / var(--ifm-pre-line-height) var(--ifm-font-family-monospace)"><span style="color:red">Out: </span><pre style="margin:0px;background-color:inherit;padding:8px"><p style="margin-bottom:0px">[INFO 09-29 17:04:41] ax.service.ax_client: Generated new trial 22 with parameters {&#x27;lr&#x27;: 0.000274, &#x27;momentum&#x27;: 0.0} using model BoTorch.</p></pre></div>
<div style="background-color:var(--ifm-pre-background);margin-bottom:10px;border-radius:var(--ifm-global-radius);overflow:hidden;padding:5px;font:var(--ifm-code-font-size) / var(--ifm-pre-line-height) var(--ifm-font-family-monospace)"><span style="color:red">Out: </span><pre style="margin:0px;background-color:inherit;padding:8px"><p style="margin-bottom:0px">[INFO 09-29 17:04:44] ax.service.ax_client: Completed trial 22 with data: {&#x27;accuracy&#x27;: (0.863333, None)}.</p></pre></div>
<div style="background-color:var(--ifm-pre-background);margin-bottom:10px;border-radius:var(--ifm-global-radius);overflow:hidden;padding:5px;font:var(--ifm-code-font-size) / var(--ifm-pre-line-height) var(--ifm-font-family-monospace)"><span style="color:red">Out: </span><pre style="margin:0px;background-color:inherit;padding:8px"><p style="margin-bottom:0px">[INFO 09-29 17:04:45] ax.service.ax_client: Generated new trial 23 with parameters {&#x27;lr&#x27;: 0.000139, &#x27;momentum&#x27;: 0.414705} using model BoTorch.</p></pre></div>
<div style="background-color:var(--ifm-pre-background);margin-bottom:10px;border-radius:var(--ifm-global-radius);overflow:hidden;padding:5px;font:var(--ifm-code-font-size) / var(--ifm-pre-line-height) var(--ifm-font-family-monospace)"><span style="color:red">Out: </span><pre style="margin:0px;background-color:inherit;padding:8px"><p style="margin-bottom:0px">[INFO 09-29 17:04:50] ax.service.ax_client: Completed trial 23 with data: {&#x27;accuracy&#x27;: (0.920667, None)}.</p></pre></div>
<div style="background-color:var(--ifm-pre-background);margin-bottom:10px;border-radius:var(--ifm-global-radius);overflow:hidden;padding:5px;font:var(--ifm-code-font-size) / var(--ifm-pre-line-height) var(--ifm-font-family-monospace)"><span style="color:red">Out: </span><pre style="margin:0px;background-color:inherit;padding:8px"><p style="margin-bottom:0px">[INFO 09-29 17:04:51] ax.service.ax_client: Generated new trial 24 with parameters {&#x27;lr&#x27;: 0.00011, &#x27;momentum&#x27;: 0.494636} using model BoTorch.</p></pre></div>
<div style="background-color:var(--ifm-pre-background);margin-bottom:10px;border-radius:var(--ifm-global-radius);overflow:hidden;padding:5px;font:var(--ifm-code-font-size) / var(--ifm-pre-line-height) var(--ifm-font-family-monospace)"><span style="color:red">Out: </span><pre style="margin:0px;background-color:inherit;padding:8px"><p style="margin-bottom:0px">[INFO 09-29 17:04:54] ax.service.ax_client: Completed trial 24 with data: {&#x27;accuracy&#x27;: (0.911833, None)}.</p></pre></div>
<div style="background-color:var(--ifm-pre-background);margin-bottom:10px;border-radius:var(--ifm-global-radius);overflow:hidden;padding:5px;font:var(--ifm-code-font-size) / var(--ifm-pre-line-height) var(--ifm-font-family-monospace)"><span style="color:red">Out: </span><pre style="margin:0px;background-color:inherit;padding:8px"><p style="margin-bottom:0px">[INFO 09-29 17:04:55] ax.service.ax_client: Generated new trial 25 with parameters {&#x27;lr&#x27;: 0.00018, &#x27;momentum&#x27;: 0.489022} using model BoTorch.</p></pre></div>
<div style="background-color:var(--ifm-pre-background);margin-bottom:10px;border-radius:var(--ifm-global-radius);overflow:hidden;padding:5px;font:var(--ifm-code-font-size) / var(--ifm-pre-line-height) var(--ifm-font-family-monospace)"><span style="color:red">Out: </span><pre style="margin:0px;background-color:inherit;padding:8px"><p style="margin-bottom:0px">[INFO 09-29 17:04:58] ax.service.ax_client: Completed trial 25 with data: {&#x27;accuracy&#x27;: (0.902833, None)}.</p></pre></div>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="how-many-trials-can-run-in-parallel">How many trials can run in parallel?<a href="#how-many-trials-can-run-in-parallel" class="hash-link" aria-label="Direct link to How many trials can run in parallel?" title="Direct link to How many trials can run in parallel?">​</a></h3>
<p>By default, Ax restricts number of trials that can run in parallel for some optimization
stages, in order to improve the optimization performance and reduce the number of trials
that the optimization will require. To check the maximum parallelism for each
optimization stage:</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">ax_client</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">get_max_parallelism</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div style="background-color:var(--ifm-pre-background);margin-bottom:10px;border-radius:var(--ifm-global-radius);overflow:hidden;padding:5px;font:var(--ifm-code-font-size) / var(--ifm-pre-line-height) var(--ifm-font-family-monospace)"><span style="color:red">Out: </span><pre style="margin:0px;background-color:inherit;padding:8px"><p style="margin-bottom:0px">[(5, 5), (-1, 3)]</p></pre></div>
<p>The output of this function is a list of tuples of form (number of trials, max
parallelism), so the example above means &quot;the max parallelism is 5 for the first 5
trials and 3 for all subsequent trials.&quot; This is because the first 5 trials are produced
quasi-randomly and can all be evaluated at once, and subsequent trials are produced via
Bayesian optimization, which converges on optimal point in fewer trials when parallelism
is limited. MaxParallelismReachedException indicates that the parallelism limit has been
reached –– refer to the &#x27;Service API Exceptions Meaning and Handling&#x27; section at the end
of the tutorial for handling.</p>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="how-to-view-all-existing-trials-during-optimization">How to view all existing trials during optimization?<a href="#how-to-view-all-existing-trials-during-optimization" class="hash-link" aria-label="Direct link to How to view all existing trials during optimization?" title="Direct link to How to view all existing trials during optimization?">​</a></h3>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">ax_client</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">get_trials_data_frame</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div style="background-color:var(--ifm-pre-background);margin-bottom:10px;border-radius:var(--ifm-global-radius);overflow:hidden;padding:5px;font:var(--ifm-code-font-size) / var(--ifm-pre-line-height) var(--ifm-font-family-monospace)"><span style="color:red">Out: </span><pre style="margin:0px;background-color:inherit;padding:8px"><p style="margin-bottom:0px">[WARNING 09-29 17:04:59] ax.service.utils.report_utils: Column reason missing for all trials. Not appending column.</p></pre></div>
<table><thead><tr><th style="text-align:right"></th><th style="text-align:right">trial_index</th><th style="text-align:right">arm_name</th><th style="text-align:left">trial_status</th><th style="text-align:left">generation_method</th><th style="text-align:right">accuracy</th><th style="text-align:right">lr</th><th style="text-align:right">momentum</th></tr></thead><tbody><tr><td style="text-align:right">0</td><td style="text-align:right">0</td><td style="text-align:right">0_0</td><td style="text-align:left">COMPLETED</td><td style="text-align:left">Manual</td><td style="text-align:right">0.841833</td><td style="text-align:right">2.6e-05</td><td style="text-align:right">0.58</td></tr><tr><td style="text-align:right">1</td><td style="text-align:right">1</td><td style="text-align:right">1_0</td><td style="text-align:left">COMPLETED</td><td style="text-align:left">Sobol</td><td style="text-align:right">0.100333</td><td style="text-align:right">0.009955</td><td style="text-align:right">0.633423</td></tr><tr><td style="text-align:right">2</td><td style="text-align:right">2</td><td style="text-align:right">2_0</td><td style="text-align:left">COMPLETED</td><td style="text-align:left">Sobol</td><td style="text-align:right">0.884167</td><td style="text-align:right">9e-05</td><td style="text-align:right">0.335441</td></tr><tr><td style="text-align:right">3</td><td style="text-align:right">3</td><td style="text-align:right">3_0</td><td style="text-align:left">COMPLETED</td><td style="text-align:left">Sobol</td><td style="text-align:right">0.678667</td><td style="text-align:right">2e-06</td><td style="text-align:right">0.902833</td></tr><tr><td style="text-align:right">4</td><td style="text-align:right">4</td><td style="text-align:right">4_0</td><td style="text-align:left">COMPLETED</td><td style="text-align:left">Sobol</td><td style="text-align:right">0.100333</td><td style="text-align:right">0.10174</td><td style="text-align:right">0.065787</td></tr><tr><td style="text-align:right">5</td><td style="text-align:right">5</td><td style="text-align:right">5_0</td><td style="text-align:left">COMPLETED</td><td style="text-align:left">Sobol</td><td style="text-align:right">0.088167</td><td style="text-align:right">0.017004</td><td style="text-align:right">0.802601</td></tr><tr><td style="text-align:right">6</td><td style="text-align:right">6</td><td style="text-align:right">6_0</td><td style="text-align:left">COMPLETED</td><td style="text-align:left">BoTorch</td><td style="text-align:right">0.756167</td><td style="text-align:right">3.5e-05</td><td style="text-align:right">0</td></tr><tr><td style="text-align:right">7</td><td style="text-align:right">7</td><td style="text-align:right">7_0</td><td style="text-align:left">COMPLETED</td><td style="text-align:left">BoTorch</td><td style="text-align:right">0.908</td><td style="text-align:right">8.5e-05</td><td style="text-align:right">1</td></tr><tr><td style="text-align:right">8</td><td style="text-align:right">8</td><td style="text-align:right">8_0</td><td style="text-align:left">COMPLETED</td><td style="text-align:left">BoTorch</td><td style="text-align:right">0.7935</td><td style="text-align:right">4.7e-05</td><td style="text-align:right">1</td></tr><tr><td style="text-align:right">9</td><td style="text-align:right">9</td><td style="text-align:right">9_0</td><td style="text-align:left">COMPLETED</td><td style="text-align:left">BoTorch</td><td style="text-align:right">0.821333</td><td style="text-align:right">0.000186</td><td style="text-align:right">0.914201</td></tr><tr><td style="text-align:right">10</td><td style="text-align:right">10</td><td style="text-align:right">10_0</td><td style="text-align:left">COMPLETED</td><td style="text-align:left">BoTorch</td><td style="text-align:right">0.855333</td><td style="text-align:right">0.000155</td><td style="text-align:right">0</td></tr><tr><td style="text-align:right">11</td><td style="text-align:right">11</td><td style="text-align:right">11_0</td><td style="text-align:left">COMPLETED</td><td style="text-align:left">BoTorch</td><td style="text-align:right">0.847833</td><td style="text-align:right">9.7e-05</td><td style="text-align:right">0</td></tr><tr><td style="text-align:right">12</td><td style="text-align:right">12</td><td style="text-align:right">12_0</td><td style="text-align:left">COMPLETED</td><td style="text-align:left">BoTorch</td><td style="text-align:right">0.850333</td><td style="text-align:right">0.000121</td><td style="text-align:right">1</td></tr><tr><td style="text-align:right">13</td><td style="text-align:right">13</td><td style="text-align:right">13_0</td><td style="text-align:left">COMPLETED</td><td style="text-align:left">BoTorch</td><td style="text-align:right">0.917833</td><td style="text-align:right">0.000116</td><td style="text-align:right">0.52957</td></tr><tr><td style="text-align:right">14</td><td style="text-align:right">14</td><td style="text-align:right">14_0</td><td style="text-align:left">COMPLETED</td><td style="text-align:left">BoTorch</td><td style="text-align:right">0.907833</td><td style="text-align:right">0.000174</td><td style="text-align:right">0.407224</td></tr><tr><td style="text-align:right">15</td><td style="text-align:right">15</td><td style="text-align:right">15_0</td><td style="text-align:left">COMPLETED</td><td style="text-align:left">BoTorch</td><td style="text-align:right">0.167833</td><td style="text-align:right">1e-06</td><td style="text-align:right">0</td></tr><tr><td style="text-align:right">16</td><td style="text-align:right">16</td><td style="text-align:right">16_0</td><td style="text-align:left">COMPLETED</td><td style="text-align:left">BoTorch</td><td style="text-align:right">0.9085</td><td style="text-align:right">8.9e-05</td><td style="text-align:right">0.520364</td></tr><tr><td style="text-align:right">17</td><td style="text-align:right">17</td><td style="text-align:right">17_0</td><td style="text-align:left">COMPLETED</td><td style="text-align:left">BoTorch</td><td style="text-align:right">0.908833</td><td style="text-align:right">0.000121</td><td style="text-align:right">0.420034</td></tr><tr><td style="text-align:right">18</td><td style="text-align:right">18</td><td style="text-align:right">18_0</td><td style="text-align:left">COMPLETED</td><td style="text-align:left">BoTorch</td><td style="text-align:right">0.904333</td><td style="text-align:right">9.3e-05</td><td style="text-align:right">0.602704</td></tr><tr><td style="text-align:right">19</td><td style="text-align:right">19</td><td style="text-align:right">19_0</td><td style="text-align:left">COMPLETED</td><td style="text-align:left">BoTorch</td><td style="text-align:right">0.0955</td><td style="text-align:right">0.4</td><td style="text-align:right">1</td></tr><tr><td style="text-align:right">20</td><td style="text-align:right">20</td><td style="text-align:right">20_0</td><td style="text-align:left">COMPLETED</td><td style="text-align:left">BoTorch</td><td style="text-align:right">0.906</td><td style="text-align:right">0.000101</td><td style="text-align:right">0.460781</td></tr><tr><td style="text-align:right">21</td><td style="text-align:right">21</td><td style="text-align:right">21_0</td><td style="text-align:left">COMPLETED</td><td style="text-align:left">BoTorch</td><td style="text-align:right">0.922167</td><td style="text-align:right">0.000142</td><td style="text-align:right">0.507193</td></tr><tr><td style="text-align:right">22</td><td style="text-align:right">22</td><td style="text-align:right">22_0</td><td style="text-align:left">COMPLETED</td><td style="text-align:left">BoTorch</td><td style="text-align:right">0.863333</td><td style="text-align:right">0.000274</td><td style="text-align:right">0</td></tr><tr><td style="text-align:right">23</td><td style="text-align:right">23</td><td style="text-align:right">23_0</td><td style="text-align:left">COMPLETED</td><td style="text-align:left">BoTorch</td><td style="text-align:right">0.920667</td><td style="text-align:right">0.000139</td><td style="text-align:right">0.414705</td></tr><tr><td style="text-align:right">24</td><td style="text-align:right">24</td><td style="text-align:right">24_0</td><td style="text-align:left">COMPLETED</td><td style="text-align:left">BoTorch</td><td style="text-align:right">0.911833</td><td style="text-align:right">0.00011</td><td style="text-align:right">0.494636</td></tr><tr><td style="text-align:right">25</td><td style="text-align:right">25</td><td style="text-align:right">25_0</td><td style="text-align:left">COMPLETED</td><td style="text-align:left">BoTorch</td><td style="text-align:right">0.902833</td><td style="text-align:right">0.00018</td><td style="text-align:right">0.489022</td></tr></tbody></table>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="6-retrieve-best-parameters">6. Retrieve best parameters<a href="#6-retrieve-best-parameters" class="hash-link" aria-label="Direct link to 6. Retrieve best parameters" title="Direct link to 6. Retrieve best parameters">​</a></h2>
<p>Once it&#x27;s complete, we can access the best parameters found, as well as the
corresponding metric values. Note that these parameters may not necessarily be the set
that yielded the highest <em>observed</em> accuracy because Ax uses the highest model
<em>predicted</em> accuracy to choose the best parameters (see
<a href="https://ax.dev/api/service.html#module-ax.service.utils.best_point_mixin" target="_blank" rel="noopener noreferrer">here</a> for
more details). Due to randomness in the data or the algorithm itself, using observed
accuracy may result in choosing an outlier for the best set of parameters. Using the
model predicted best will use the model to regularize the observations and reduce the
likelihood of picking some outlier in the data.</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">best_parameters</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> values </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> ax_client</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">get_best_parameters</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">best_parameters</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div style="background-color:var(--ifm-pre-background);margin-bottom:10px;border-radius:var(--ifm-global-radius);overflow:hidden;padding:5px;font:var(--ifm-code-font-size) / var(--ifm-pre-line-height) var(--ifm-font-family-monospace)"><span style="color:red">Out: </span><pre style="margin:0px;background-color:inherit;padding:8px"><p style="margin-bottom:0px">{&#x27;lr&#x27;: 0.00014152067288925645, &#x27;momentum&#x27;: 0.5071930879797697}</p></pre></div>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">mean</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> covariance </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> values</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">mean</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div style="background-color:var(--ifm-pre-background);margin-bottom:10px;border-radius:var(--ifm-global-radius);overflow:hidden;padding:5px;font:var(--ifm-code-font-size) / var(--ifm-pre-line-height) var(--ifm-font-family-monospace)"><span style="color:red">Out: </span><pre style="margin:0px;background-color:inherit;padding:8px"><p style="margin-bottom:0px">{&#x27;accuracy&#x27;: 0.910329840245651}</p></pre></div>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="7-plot-the-response-surface-and-optimization-trace">7. Plot the response surface and optimization trace<a href="#7-plot-the-response-surface-and-optimization-trace" class="hash-link" aria-label="Direct link to 7. Plot the response surface and optimization trace" title="Direct link to 7. Plot the response surface and optimization trace">​</a></h2>
<p>Contour plot showing classification accuracy as a function of the two hyperparameters.</p>
<p>The black squares show points that we have actually run; notice how they are clustered
in the optimal region.</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">render</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">ax_client</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">get_contour_plot</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">param_x</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;lr&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> param_y</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;momentum&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> metric_name</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;accuracy&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div style="background-color:var(--ifm-pre-background);margin-bottom:10px;border-radius:var(--ifm-global-radius);overflow:hidden;padding:5px;font:var(--ifm-code-font-size) / var(--ifm-pre-line-height) var(--ifm-font-family-monospace)"><span style="color:red">Out: </span><pre style="margin:0px;background-color:inherit;padding:8px"><p style="margin-bottom:0px">[INFO 09-29 17:04:59] ax.service.ax_client: Retrieving contour plot with parameter &#x27;lr&#x27; on X-axis and &#x27;momentum&#x27; on Y-axis, for metric &#x27;accuracy&#x27;. Remaining parameters are affixed to the middle of their range.</p></pre></div>
<div class="plotly-figure" style="overflow-x:auto"><div>loading...</div></div>
<p>Here we plot the optimization trace, showing the progression of finding the point with
the optimal objective:</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">render</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    ax_client</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">get_optimization_trace</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain">  </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="plotly-figure" style="overflow-x:auto"><div>loading...</div></div>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="8-train-cnn-with-best-hyperparameters-and-evaluate-on-test-set">8. Train CNN with best hyperparameters and evaluate on test set<a href="#8-train-cnn-with-best-hyperparameters-and-evaluate-on-test-set" class="hash-link" aria-label="Direct link to 8. Train CNN with best hyperparameters and evaluate on test set" title="Direct link to 8. Train CNN with best hyperparameters and evaluate on test set">​</a></h2>
<p>Note that the resulting accuracy on the test set generally won&#x27;t be the same as the
maximum accuracy achieved on the evaluation set throughout optimization.</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">df </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> ax_client</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">get_trials_data_frame</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">best_arm_idx </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> df</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">trial_index</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain">df</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;accuracy&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">==</span><span class="token plain"> df</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;accuracy&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token builtin" style="color:rgb(130, 170, 255)">max</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">values</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">best_arm </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> ax_client</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">get_trial_parameters</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">best_arm_idx</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">best_arm</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div style="background-color:var(--ifm-pre-background);margin-bottom:10px;border-radius:var(--ifm-global-radius);overflow:hidden;padding:5px;font:var(--ifm-code-font-size) / var(--ifm-pre-line-height) var(--ifm-font-family-monospace)"><span style="color:red">Out: </span><pre style="margin:0px;background-color:inherit;padding:8px"><p style="margin-bottom:0px">[WARNING 09-29 17:05:00] ax.service.utils.report_utils: Column reason missing for all trials. Not appending column.</p></pre></div>
<div style="background-color:var(--ifm-pre-background);margin-bottom:10px;border-radius:var(--ifm-global-radius);overflow:hidden;padding:5px;font:var(--ifm-code-font-size) / var(--ifm-pre-line-height) var(--ifm-font-family-monospace)"><span style="color:red">Out: </span><pre style="margin:0px;background-color:inherit;padding:8px"><p style="margin-bottom:0px">{&#x27;lr&#x27;: 0.00014152067288925645, &#x27;momentum&#x27;: 0.5071930879797697}</p></pre></div>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">combined_train_valid_set </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> torch</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">utils</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">data</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">ConcatDataset</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        train_loader</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">dataset</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">dataset</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        valid_loader</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">dataset</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">dataset</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">combined_train_valid_loader </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> torch</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">utils</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">data</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">DataLoader</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    combined_train_valid_set</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    batch_size</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">BATCH_SIZE</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    shuffle</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token boolean" style="color:rgb(255, 88, 116)">True</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">net </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> train</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    net</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">CNN</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    train_loader</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">combined_train_valid_loader</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    parameters</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">best_arm</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    dtype</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">dtype</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    device</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">device</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">test_accuracy </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> evaluate</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    net</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">net</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    data_loader</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">test_loader</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    dtype</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">dtype</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    device</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">device</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">print</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string-interpolation string" style="color:rgb(195, 232, 141)">f&quot;Classification Accuracy (test set): </span><span class="token string-interpolation interpolation punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token string-interpolation interpolation builtin" style="color:rgb(130, 170, 255)">round</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string-interpolation interpolation">test_accuracy</span><span class="token string-interpolation interpolation operator" style="color:rgb(137, 221, 255)">*</span><span class="token string-interpolation interpolation number" style="color:rgb(247, 140, 108)">100</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token string-interpolation interpolation"> </span><span class="token string-interpolation interpolation number" style="color:rgb(247, 140, 108)">2</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token string-interpolation string" style="color:rgb(195, 232, 141)">%&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div style="background-color:var(--ifm-pre-background);margin-bottom:10px;border-radius:var(--ifm-global-radius);overflow:hidden;padding:5px;font:var(--ifm-code-font-size) / var(--ifm-pre-line-height) var(--ifm-font-family-monospace)"><span style="color:red">Out: </span><pre style="margin:0px;background-color:inherit;padding:8px"><p style="margin-bottom:0px">Classification Accuracy (test set): 96.98%</p></pre></div>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="9-save--reload-optimization-to-json--sql">9. Save / reload optimization to JSON / SQL<a href="#9-save--reload-optimization-to-json--sql" class="hash-link" aria-label="Direct link to 9. Save / reload optimization to JSON / SQL" title="Direct link to 9. Save / reload optimization to JSON / SQL">​</a></h2>
<p>We can serialize the state of optimization to JSON and save it to a <code>.json</code> file or save
it to the SQL backend. For the former:</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">ax_client</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">save_to_json_file</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># For custom filepath, pass `filepath` argument.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div style="background-color:var(--ifm-pre-background);margin-bottom:10px;border-radius:var(--ifm-global-radius);overflow:hidden;padding:5px;font:var(--ifm-code-font-size) / var(--ifm-pre-line-height) var(--ifm-font-family-monospace)"><span style="color:red">Out: </span><pre style="margin:0px;background-color:inherit;padding:8px"><p style="margin-bottom:0px">[INFO 09-29 17:05:13] ax.service.ax_client: Saved JSON-serialized state of optimization to ax_client_snapshot.json.</p></pre></div>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">restored_ax_client </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    AxClient</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">load_from_json_file</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># For custom filepath, pass `filepath` argument.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div style="background-color:var(--ifm-pre-background);margin-bottom:10px;border-radius:var(--ifm-global-radius);overflow:hidden;padding:5px;font:var(--ifm-code-font-size) / var(--ifm-pre-line-height) var(--ifm-font-family-monospace)"><span style="color:red">Out: </span><pre style="margin:0px;background-color:inherit;padding:8px"><p style="margin-bottom:0px">[INFO 09-29 17:05:14] ax.service.ax_client: Starting optimization with verbose logging. To disable logging, set the verbose_logging argument to False. Note that float values in the logs are rounded to 6 decimal points.</p></pre></div>
<p>To store state of optimization to an SQL backend, first follow
<a href="https://ax.dev/docs/storage.html#sql" target="_blank" rel="noopener noreferrer">setup instructions</a> on Ax website.</p>
<p>Having set up the SQL backend, pass <code>DBSettings</code> to <code>AxClient</code> on instantiation (note
that <code>SQLAlchemy</code> dependency will have to be installed – for installation, refer to
<a href="https://ax.dev/docs/installation.html#optional-dependencies" target="_blank" rel="noopener noreferrer">optional dependencies</a> on
Ax website):</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> ax</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">storage</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">sqa_store</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">structs </span><span class="token keyword" style="font-style:italic">import</span><span class="token plain"> DBSettings</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># URL is of the form &quot;dialect+driver://username:password@host:port/database&quot;.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">db_settings </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> DBSettings</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">url</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;sqlite:///foo.db&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># Instead of URL, can provide a `creator function`; can specify custom encoders/decoders if necessary.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">new_ax </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> AxClient</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">db_settings</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">db_settings</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div style="background-color:var(--ifm-pre-background);margin-bottom:10px;border-radius:var(--ifm-global-radius);overflow:hidden;padding:5px;font:var(--ifm-code-font-size) / var(--ifm-pre-line-height) var(--ifm-font-family-monospace)"><span style="color:red">Out: </span><pre style="margin:0px;background-color:inherit;padding:8px"><p style="margin-bottom:0px">[INFO 09-29 17:05:14] ax.service.ax_client: Starting optimization with verbose logging. To disable logging, set the verbose_logging argument to False. Note that float values in the logs are rounded to 6 decimal points.</p></pre></div>
<p>When valid <code>DBSettings</code> are passed into <code>AxClient</code>, a unique experiment name is a
required argument (<code>name</code>) to <code>ax_client.create_experiment</code>. The <strong>state of the
optimization is auto-saved</strong> any time it changes (i.e. a new trial is added or
completed, etc).</p>
<p>To reload an optimization state later, instantiate <code>AxClient</code> with the same <code>DBSettings</code>
and use <code>ax_client.load_experiment_from_database(experiment_name=&quot;my_experiment&quot;)</code>.</p>
<h1>Special Cases</h1>
<p><strong>Evaluation failure</strong>: should any optimization iterations fail during evaluation,
<code>log_trial_failure</code> will ensure that the same trial is not proposed again.</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">_</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> trial_index </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> ax_client</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">get_next_trial</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">ax_client</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">log_trial_failure</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">trial_index</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">trial_index</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div style="background-color:var(--ifm-pre-background);margin-bottom:10px;border-radius:var(--ifm-global-radius);overflow:hidden;padding:5px;font:var(--ifm-code-font-size) / var(--ifm-pre-line-height) var(--ifm-font-family-monospace)"><span style="color:red">Out: </span><pre style="margin:0px;background-color:inherit;padding:8px"><p style="margin-bottom:0px">[INFO 09-29 17:05:15] ax.service.ax_client: Generated new trial 26 with parameters {&#x27;lr&#x27;: 0.000286, &#x27;momentum&#x27;: 0.42988} using model BoTorch.</p></pre></div>
<div style="background-color:var(--ifm-pre-background);margin-bottom:10px;border-radius:var(--ifm-global-radius);overflow:hidden;padding:5px;font:var(--ifm-code-font-size) / var(--ifm-pre-line-height) var(--ifm-font-family-monospace)"><span style="color:red">Out: </span><pre style="margin:0px;background-color:inherit;padding:8px"><p style="margin-bottom:0px">[INFO 09-29 17:05:15] ax.service.ax_client: Registered failure of trial 26.</p></pre></div>
<p><strong>Need to run many trials in parallel</strong>: for optimal results and optimization
efficiency, we strongly recommend sequential optimization (generating a few trials, then
waiting for them to be completed with evaluation data). However, if your use case needs
to dispatch many trials in parallel before they are updated with data and you are
running into the <em>&quot;All trials for current model have been generated, but not enough data
has been observed to fit next model&quot;</em> error, instantiate <code>AxClient</code> as
<code>AxClient(enforce_sequential_optimization=False)</code>.</p>
<h1>Service API Exceptions Meaning and Handling</h1>
<p><a href="https://ax.dev/api/exceptions.html#ax.exceptions.core.DataRequiredError" target="_blank" rel="noopener noreferrer"><strong><code>DataRequiredError</code></strong></a>:
Ax generation strategy needs to be updated with more data to proceed to the next
optimization model. When the optimization moves from initialization stage to the
Bayesian optimization stage, the underlying BayesOpt model needs sufficient data to
train. For optimal results and optimization efficiency (finding the optimal point in the
least number of trials), we recommend sequential optimization (generating a few trials,
then waiting for them to be completed with evaluation data). Therefore, the correct way
to handle this exception is to wait until more trial evaluations complete and log their
data via <code>ax_client.complete_trial(...)</code>.</p>
<p>However, if there is strong need to generate more trials before more data is available,
instantiate <code>AxClient</code> as <code>AxClient(enforce_sequential_optimization=False)</code>. With this
setting, as many trials will be generated from the initialization stage as requested,
and the optimization will move to the BayesOpt stage whenever enough trials are
completed.</p>
<p><a href="https://ax.dev/api/modelbridge.html#ax.modelbridge.generation_strategy.MaxParallelismReachedException" target="_blank" rel="noopener noreferrer"><strong><code>MaxParallelismReachedException</code></strong></a>:
generation strategy restricts the number of trials that can be run simultaneously (to
encourage sequential optimization), and the parallelism limit has been reached. The
correct way to handle this exception is the same as <code>DataRequiredError</code> – to wait until
more trial evluations complete and log their data via <code>ax_client.complete_trial(...)</code>.</p>
<p>In some cases higher parallelism is important, so
<code>enforce_sequential_optimization=False</code> kwarg to AxClient allows the user to suppress
limiting of parallelism. It&#x27;s also possible to override the default parallelism setting
for all stages of the optimization by passing <code>choose_generation_strategy_kwargs</code> to
<code>ax_client.create_experiment</code>:</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">ax_client </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> AxClient</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">ax_client</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">create_experiment</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    parameters</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;name&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;x&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;type&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;range&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;bounds&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token number" style="color:rgb(247, 140, 108)">5.0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">10.0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;name&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;y&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;type&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;range&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;bounds&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token number" style="color:rgb(247, 140, 108)">0.0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">15.0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># Sets max parallelism to 10 for all steps of the generation strategy.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    choose_generation_strategy_kwargs</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;max_parallelism_override&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">10</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div style="background-color:var(--ifm-pre-background);margin-bottom:10px;border-radius:var(--ifm-global-radius);overflow:hidden;padding:5px;font:var(--ifm-code-font-size) / var(--ifm-pre-line-height) var(--ifm-font-family-monospace)"><span style="color:red">Out: </span><pre style="margin:0px;background-color:inherit;padding:8px"><p style="margin-bottom:0px">[INFO 09-29 17:05:15] ax.service.ax_client: Starting optimization with verbose logging. To disable logging, set the verbose_logging argument to False. Note that float values in the logs are rounded to 6 decimal points.</p></pre></div>
<div style="background-color:var(--ifm-pre-background);margin-bottom:10px;border-radius:var(--ifm-global-radius);overflow:hidden;padding:5px;font:var(--ifm-code-font-size) / var(--ifm-pre-line-height) var(--ifm-font-family-monospace)"><span style="color:red">Out: </span><pre style="margin:0px;background-color:inherit;padding:8px"><p style="margin-bottom:0px">[INFO 09-29 17:05:15] ax.service.utils.instantiation: Inferred value type of ParameterType.FLOAT for parameter x. If that is not the expected value type, you can explicitly specify &#x27;value_type&#x27; (&#x27;int&#x27;, &#x27;float&#x27;, &#x27;bool&#x27; or &#x27;str&#x27;) in parameter dict.</p></pre></div>
<div style="background-color:var(--ifm-pre-background);margin-bottom:10px;border-radius:var(--ifm-global-radius);overflow:hidden;padding:5px;font:var(--ifm-code-font-size) / var(--ifm-pre-line-height) var(--ifm-font-family-monospace)"><span style="color:red">Out: </span><pre style="margin:0px;background-color:inherit;padding:8px"><p style="margin-bottom:0px">[INFO 09-29 17:05:15] ax.service.utils.instantiation: Inferred value type of ParameterType.FLOAT for parameter y. If that is not the expected value type, you can explicitly specify &#x27;value_type&#x27; (&#x27;int&#x27;, &#x27;float&#x27;, &#x27;bool&#x27; or &#x27;str&#x27;) in parameter dict.</p></pre></div>
<div style="background-color:var(--ifm-pre-background);margin-bottom:10px;border-radius:var(--ifm-global-radius);overflow:hidden;padding:5px;font:var(--ifm-code-font-size) / var(--ifm-pre-line-height) var(--ifm-font-family-monospace)"><span style="color:red">Out: </span><pre style="margin:0px;background-color:inherit;padding:8px"><p style="margin-bottom:0px">[INFO 09-29 17:05:15] ax.service.utils.instantiation: Created search space: SearchSpace(parameters=[RangeParameter(name=&#x27;x&#x27;, parameter_type=FLOAT, range=[-5.0, 10.0]), RangeParameter(name=&#x27;y&#x27;, parameter_type=FLOAT, range=[0.0, 15.0])], parameter_constraints=[]).</p></pre></div>
<div style="background-color:var(--ifm-pre-background);margin-bottom:10px;border-radius:var(--ifm-global-radius);overflow:hidden;padding:5px;font:var(--ifm-code-font-size) / var(--ifm-pre-line-height) var(--ifm-font-family-monospace)"><span style="color:red">Out: </span><pre style="margin:0px;background-color:inherit;padding:8px"><p style="margin-bottom:0px">[INFO 09-29 17:05:15] ax.modelbridge.dispatch_utils: Using Models.BOTORCH_MODULAR since there is at least one ordered parameter and there are no unordered categorical parameters.</p></pre></div>
<div style="background-color:var(--ifm-pre-background);margin-bottom:10px;border-radius:var(--ifm-global-radius);overflow:hidden;padding:5px;font:var(--ifm-code-font-size) / var(--ifm-pre-line-height) var(--ifm-font-family-monospace)"><span style="color:red">Out: </span><pre style="margin:0px;background-color:inherit;padding:8px"><p style="margin-bottom:0px">[INFO 09-29 17:05:15] ax.modelbridge.dispatch_utils: Calculating the number of remaining initialization trials based on num_initialization_trials=None max_initialization_trials=None num_tunable_parameters=2 num_trials=None use_batch_trials=False</p></pre></div>
<div style="background-color:var(--ifm-pre-background);margin-bottom:10px;border-radius:var(--ifm-global-radius);overflow:hidden;padding:5px;font:var(--ifm-code-font-size) / var(--ifm-pre-line-height) var(--ifm-font-family-monospace)"><span style="color:red">Out: </span><pre style="margin:0px;background-color:inherit;padding:8px"><p style="margin-bottom:0px">[INFO 09-29 17:05:15] ax.modelbridge.dispatch_utils: calculated num_initialization_trials=5</p></pre></div>
<div style="background-color:var(--ifm-pre-background);margin-bottom:10px;border-radius:var(--ifm-global-radius);overflow:hidden;padding:5px;font:var(--ifm-code-font-size) / var(--ifm-pre-line-height) var(--ifm-font-family-monospace)"><span style="color:red">Out: </span><pre style="margin:0px;background-color:inherit;padding:8px"><p style="margin-bottom:0px">[INFO 09-29 17:05:15] ax.modelbridge.dispatch_utils: num_completed_initialization_trials=0 num_remaining_initialization_trials=5</p></pre></div>
<div style="background-color:var(--ifm-pre-background);margin-bottom:10px;border-radius:var(--ifm-global-radius);overflow:hidden;padding:5px;font:var(--ifm-code-font-size) / var(--ifm-pre-line-height) var(--ifm-font-family-monospace)"><span style="color:red">Out: </span><pre style="margin:0px;background-color:inherit;padding:8px"><p style="margin-bottom:0px">[INFO 09-29 17:05:15] ax.modelbridge.dispatch_utils: verbose, disable_progbar, and jit_compile are not yet supported when using choose_generation_strategy with ModularBoTorchModel, dropping these arguments.</p></pre></div>
<div style="background-color:var(--ifm-pre-background);margin-bottom:10px;border-radius:var(--ifm-global-radius);overflow:hidden;padding:5px;font:var(--ifm-code-font-size) / var(--ifm-pre-line-height) var(--ifm-font-family-monospace)"><span style="color:red">Out: </span><pre style="margin:0px;background-color:inherit;padding:8px"><p style="margin-bottom:0px">[INFO 09-29 17:05:15] ax.modelbridge.dispatch_utils: Using Bayesian Optimization generation strategy: GenerationStrategy(name=&#x27;Sobol+BoTorch&#x27;, steps=[Sobol for 5 trials, BoTorch for subsequent trials]). Iterations after 5 will take longer to generate due to model-fitting.</p></pre></div>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">ax_client</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">get_max_parallelism</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># Max parallelism is now 10 for all stages of the optimization.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div style="background-color:var(--ifm-pre-background);margin-bottom:10px;border-radius:var(--ifm-global-radius);overflow:hidden;padding:5px;font:var(--ifm-code-font-size) / var(--ifm-pre-line-height) var(--ifm-font-family-monospace)"><span style="color:red">Out: </span><pre style="margin:0px;background-color:inherit;padding:8px"><p style="margin-bottom:0px">[(5, 10), (-1, 10)]</p></pre></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"></div><div class="col lastUpdated_JAkA"><span class="theme-last-updated">Last updated<!-- --> on <b><time datetime="2024-11-26T23:01:37.000Z" itemprop="dateModified">Nov 26, 2024</time></b> by <b>Cristian Lara</b></span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/Ax/docs/tutorials/modular_botax/"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Modular `BoTorchModel`</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/Ax/docs/tutorials/submitit/"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Hyperparameter Optimization on SLURM via SubmitIt</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#1-load-mnist-data" class="table-of-contents__link toc-highlight">1. Load MNIST data</a></li><li><a href="#2-initialize-client" class="table-of-contents__link toc-highlight">2. Initialize Client</a></li><li><a href="#3-set-up-experiment" class="table-of-contents__link toc-highlight">3. Set up experiment</a></li><li><a href="#4-define-how-to-evaluate-trials" class="table-of-contents__link toc-highlight">4. Define how to evaluate trials</a></li><li><a href="#5-run-optimization-loop" class="table-of-contents__link toc-highlight">5. Run optimization loop</a><ul><li><a href="#how-many-trials-can-run-in-parallel" class="table-of-contents__link toc-highlight">How many trials can run in parallel?</a></li><li><a href="#how-to-view-all-existing-trials-during-optimization" class="table-of-contents__link toc-highlight">How to view all existing trials during optimization?</a></li></ul></li><li><a href="#6-retrieve-best-parameters" class="table-of-contents__link toc-highlight">6. Retrieve best parameters</a></li><li><a href="#7-plot-the-response-surface-and-optimization-trace" class="table-of-contents__link toc-highlight">7. Plot the response surface and optimization trace</a></li><li><a href="#8-train-cnn-with-best-hyperparameters-and-evaluate-on-test-set" class="table-of-contents__link toc-highlight">8. Train CNN with best hyperparameters and evaluate on test set</a></li><li><a href="#9-save--reload-optimization-to-json--sql" class="table-of-contents__link toc-highlight">9. Save / reload optimization to JSON / SQL</a></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/Ax/docs/why-ax">Introduction</a></li></ul></div><div class="col footer__col"><div class="footer__title">Social</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/cristianlara/ax" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/cristianlara/ax/blog" target="_blank" rel="noopener noreferrer" class="footer__link-item">Blog<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Legal</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://opensource.facebook.com/legal/privacy/" target="_blank" rel="noreferrer noopener" class="footer__link-item">Privacy<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://opensource.facebook.com/legal/terms/" target="_blank" rel="noreferrer noopener" class="footer__link-item">Terms<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="margin-bottom--sm"><img src="/Ax/img/meta_opensource_logo_negative.svg" alt="Ax" class="footer__logo themedComponent_mlkZ themedComponent--light_NVdE"><img src="/Ax/img/meta_opensource_logo_negative.svg" alt="Ax" class="footer__logo themedComponent_mlkZ themedComponent--dark_xIcU"></div><div class="footer__copyright">Copyright © 2024 Meta Platforms, Inc.</div></div></div></footer></div>
</body>
</html>
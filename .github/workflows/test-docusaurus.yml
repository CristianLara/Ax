name: Test Docusaurus

on:
  workflow_dispatch:
  pull_request:
    branches: [ main ]

jobs:
  make-commit:
    runs-on: ubuntu-latest
    outputs:
      new-commit-sha: ${{ steps.make-commit.outputs.NEW_COMMIT_SHA }}
    steps:
    - uses: actions/checkout@v4
    - name: make test commit
      id: make-commit
      run: |
        git rev-parse HEAD
        git log | head -n 5
        echo "testing" >> README.md
        git config --global user.name "github-actions[bot]"
        git config --global user.email "41898282+github-actions[bot]@users.noreply.github.com"
        git add --all
        git commit -m "test change to README.md"
        git push --force origin HEAD:$GITHUB_HEAD_REF
        git rev-parse HEAD
        git log | head -n 5
        echo "NEW_COMMIT_SHA=$(git rev-parse HEAD)" >> $GITHUB_OUTPUT

  checkout-latest-commit:
    needs: make-commit
    name: Checkout latest commit
    uses: ./.github/workflows/test-checkout-specific-commit.yml
    with:
      ref: ${{ needs.make-commit.outputs.new-commit-sha }}
    secrets: inherit
